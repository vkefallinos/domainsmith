# One-Shot Full Prompt

_This file is auto-generated by `product-plan/generate-oneshot.cjs`._
_It concatenates all files reachable from `product-plan/prompts/one-shot-prompt.md`._

---


## product-plan/prompts/one-shot-prompt.md

```
# One-Shot Implementation Prompt

I need you to implement a complete web application based on detailed UI designs and product specifications I'm providing.

## Instructions

Please carefully read and analyze the following files:

1. **@product-plan/product-overview.md** — Product summary with sections and entity overview
2. **@product-plan/instructions/one-shot-instructions.md** — Complete implementation instructions for all milestones

After reading these, also review:
- **@product-plan/design-system/** — Color and typography tokens
- **@product-plan/data-shapes/** — UI data contracts (the shapes of data the components expect)
- **@product-plan/shell/** — Application shell components
- **@product-plan/sections/** — All section components, types, sample data, and test specs

## Before You Begin

Review all the provided files, then ask me clarifying questions about:

1. **My tech stack** — What framework, language, and tools I'm using, and any existing codebase conventions
2. **Authentication & users** — How users should sign up, log in, and what permissions exist
3. **Product requirements** — Anything in the specs or user flows that needs clarification
4. **Anything else** — Whatever you need to know before implementing

Lastly, ask me if I have any additional notes for this implementation.

Once I answer your questions, create a comprehensive implementation plan before coding.

```


## product-plan/product-overview.md

```
# DomainSmith — Product Overview

## Summary

DomainSmith is a multi-user, schema-driven platform that enables domain experts to collaboratively author, visually configure, and deploy highly specialized AI agents without writing code.

The platform provides a modular, file-based approach where experts author isolated prompt fragments (tone, constraints, knowledge) that are automatically assembled into optimized system prompts. Users configure specialized agents through dynamic, type-safe forms generated from directory structures. The system supports isolated workspaces for individual experts and shared environments for cross-functional collaboration, with version-controlled prompt fragments.

## Planned Sections

1. **Prompt Library** — The core workspace where experts author, organize, and manage prompt fragments as a filesystem-based taxonomy of .md files
2. **Agent Builder** — The control panel where users select domains and fill out auto-generated forms to configure and instantiate specialized agents
3. **Agent Runtime** — Deploy, test, and monitor live agents — view generated system prompts, run conversations, and track agent performance
4. **Workspaces** — Manage users, permissions, and shared environments for collaborative agent development across teams and domains

## Product Entities

- **PromptFragment** — An isolated .md file containing a specific piece of agent behavior, knowledge, or constraint
- **Directory** — A folder in the taxonomy that organizes related prompt fragments, with an optional config.json for metadata
- **Schema** — A JSON Schema automatically generated from a directory tree, mapping the hierarchical structure to a type-safe form definition
- **AgentConfig** — A JSON payload generated from user form input, representing the exact configuration choices for an agent instance
- **Agent** — A deployed or runnable agent instance with its assembled system prompt, ready for conversation
- **Workspace** — A shared or isolated environment containing prompt libraries and agents, with access controls for collaboration
- **User** — A domain expert or end user who can author prompt fragments, configure agents, or interact with deployed agents
- **Conversation** — A chat session with an agent, containing messages exchanged between the user and the agent over time

## Design System

**Colors:**
- Primary: violet — Used for buttons, links, key accents, and active navigation states
- Secondary: amber — Used for hover states, subtle highlights, and destructive actions
- Neutral: slate — Used for backgrounds, borders, and text

**Typography:**
- Heading: Space Grotesk — Used for navigation items and headings
- Body: Inter — Used for body text and UI labels
- Mono: JetBrains Mono — Used for code and technical content

## Implementation Sequence

Build this product in milestones:

1. **Shell** — Set up design tokens and application shell with sidebar navigation
2. **Prompt Library** — Implement the filesystem-based workspace for prompt authoring with split-pane file tree and editor interface
3. **Agent Builder** — Build the form-centric control panel for domain selection and agent configuration with live prompt preview
4. **Agent Runtime** — Create the split-pane explorer for browsing, inspecting, and testing deployed agent instances
5. **Workspaces** — Implement the user and permission management interface with role-based access control

Each milestone has a dedicated instruction document in `product-plan/instructions/`.

```


## product-plan/instructions/incremental/01-shell.md

```
# Milestone 1: Shell

> **Provide alongside:** `product-plan/product-overview.md`
> **Prerequisites:** None

---

## About This Handoff

**What you're receiving:**
- Finished UI designs (React components with full styling)
- Product requirements and user flow specifications
- Design system tokens (colors, typography)
- Sample data showing the shape of data components expect
- Test specs focused on user-facing behavior

**Your job:**
- Integrate these components into your application
- Wire up callback props to your routing and business logic
- Replace sample data with real data from your backend
- Implement loading, error, and empty states

The components are props-based — they accept data and fire callbacks. How you architect the backend, data layer, and business logic is up to you.

---

## Goal

Set up the design tokens and application shell — the persistent chrome that wraps all sections.

## What to Implement

### 1. Design Tokens

Configure your styling system with these tokens:

- See `product-plan/design-system/tokens.css` for CSS custom properties
- See `product-plan/design-system/tailwind-colors.md` for Tailwind configuration
- See `product-plan/design-system/fonts.md` for Google Fonts setup

### 2. Application Shell

Copy the shell components from `product-plan/shell/components/` to your project:

- `AppShell.tsx` — Main layout wrapper
- `MainNav.tsx` — Navigation component
- `UserMenu.tsx` — User menu with avatar

**Wire Up Navigation:**

Connect navigation to your routing:

| Label | Route |
|-------|-------|
| Dashboard | `/` |
| Prompt Library | `/prompt-library` |
| Agent Builder | `/agent-builder` |
| Agent Runtime | `/agent-runtime` |
| Workspaces | `/workspaces` |

**User Menu:**

The user menu expects:
- User name
- Avatar URL (optional)
- Logout callback

## Files to Reference

- `product-plan/design-system/` — Design tokens
- `product-plan/shell/README.md` — Shell design intent
- `product-plan/shell/components/` — Shell React components

## Done When

- [ ] Design tokens are configured
- [ ] Shell renders with navigation
- [ ] Navigation links to correct routes
- [ ] User menu shows user info
- [ ] Responsive on mobile (hamburger menu works)

```


## product-plan/design-system/tokens.css

```
/* Design Tokens for DomainSmith */

:root {
  /* Colors */
  --color-primary-50: #f5f3ff;
  --color-primary-100: #ede9fe;
  --color-primary-200: #ddd6fe;
  --color-primary-300: #c4b5fd;
  --color-primary-400: #a78bfa;
  --color-primary-500: #8b5cf6;
  --color-primary-600: #7c3aed;
  --color-primary-700: #6d28d9;
  --color-primary-800: #5b21b6;
  --color-primary-900: #4c1d95;
  --color-primary-950: #2e1065;

  --color-secondary-50: #fffbeb;
  --color-secondary-100: #fef3c7;
  --color-secondary-200: #fde68a;
  --color-secondary-300: #fcd34d;
  --color-secondary-400: #fbbf24;
  --color-secondary-500: #f59e0b;
  --color-secondary-600: #d97706;
  --color-secondary-700: #b45309;
  --color-secondary-800: #92400e;
  --color-secondary-900: #78350f;
  --color-secondary-950: #451a03;

  --color-neutral-50: #f8fafc;
  --color-neutral-100: #f1f5f9;
  --color-neutral-200: #e2e8f0;
  --color-neutral-300: #cbd5e1;
  --color-neutral-400: #94a3b8;
  --color-neutral-500: #64748b;
  --color-neutral-600: #475569;
  --color-neutral-700: #334155;
  --color-neutral-800: #1e293b;
  --color-neutral-900: #0f172a;
  --color-neutral-950: #020617;

  /* Typography */
  --font-heading: 'Space Grotesk', sans-serif;
  --font-body: 'Inter', sans-serif;
  --font-mono: 'JetBrains Mono', monospace;

  /* Spacing */
  --spacing-xs: 0.25rem;
  --spacing-sm: 0.5rem;
  --spacing-md: 1rem;
  --spacing-lg: 1.5rem;
  --spacing-xl: 2rem;
  --spacing-2xl: 3rem;

  /* Border Radius */
  --radius-sm: 0.25rem;
  --radius-md: 0.375rem;
  --radius-lg: 0.5rem;
  --radius-xl: 0.75rem;
  --radius-2xl: 1rem;
  --radius-full: 9999px;

  /* Shadows */
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
  --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);

  /* Transitions */
  --transition-fast: 150ms ease;
  --transition-base: 200ms ease;
  --transition-slow: 300ms ease;
}

/* Dark mode overrides */
@media (prefers-color-scheme: dark) {
  :root {
    --color-neutral-50: #020617;
    --color-neutral-100: #0f172a;
    --color-neutral-200: #1e293b;
    --color-neutral-300: #334155;
    --color-neutral-400: #475569;
    --color-neutral-500: #64748b;
    --color-neutral-600: #94a3b8;
    --color-neutral-700: #cbd5e1;
    --color-neutral-800: #e2e8f0;
    --color-neutral-900: #f1f5f9;
    --color-neutral-950: #f8fafc;
  }
}

```


## product-plan/design-system/tailwind-colors.md

```
# Tailwind Color Configuration

## Color Choices

- **Primary:** `violet` — Used for buttons, links, key accents, and active navigation states
- **Secondary:** `amber` — Used for hover states, destructive actions, and subtle highlights
- **Neutral:** `slate` — Used for backgrounds, text, borders, and UI chrome

## Usage Examples

### Primary Actions
```css
/* Primary button */
bg-violet-600 hover:bg-violet-700 text-white

/* Active nav item */
bg-violet-50 dark:bg-violet-950/30 text-violet-700 dark:text-violet-300 border-l-4 border-violet-500

/* Primary link */
text-violet-600 hover:text-violet-700
```

### Secondary / Destructive
```css
/* Logout button */
text-amber-600 dark:text-amber-400 hover:bg-amber-50 dark:hover:bg-amber-950/20

/* Badge / tag */
bg-amber-100 text-amber-800
```

### Neutral Text & Backgrounds
```css
/* Body text */
text-slate-700 dark:text-slate-300

/* Muted text */
text-slate-500 dark:text-slate-400

/* Background */
bg-slate-50 dark:bg-slate-950

/* Border */
border-slate-200 dark:border-slate-800
```

## Tailwind Config (if needed)

If you're using a custom Tailwind config, these colors are available as default Tailwind classes:

```js
// tailwind.config.js
module.exports = {
  theme: {
    extend: {
      colors: {
        // violet, amber, and slate are built-in to Tailwind
        // No custom configuration needed
      }
    }
  }
}
```

```


## product-plan/design-system/fonts.md

```
# Typography Configuration

## Google Fonts Import

Add to your HTML `<head>` or CSS:

```html
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
```

## Font Usage

- **Headings:** Space Grotesk (weights 500, 600, 700)
- **Body text:** Inter (weights 400, 500, 600, 700)
- **Code/technical:** JetBrains Mono (weights 400, 500)

## CSS Font Families

```css
:root {
  --font-heading: 'Space Grotesk', sans-serif;
  --font-body: 'Inter', sans-serif;
  --font-mono: 'JetBrains Mono', monospace;
}
```

## Tailwind Config

```js
// tailwind.config.js
module.exports = {
  theme: {
    extend: {
      fontFamily: {
        heading: ['var(--font-heading)', 'sans-serif'],
        sans: ['var(--font-body)', 'sans-serif'],
        mono: ['var(--font-mono)', 'monospace'],
      }
    }
  }
}
```

## Usage Examples

```html
<!-- Heading -->
<h1 class="font-heading font-bold text-2xl">Page Title</h1>

<!-- Body text -->
<p class="font-sans text-slate-700">Body paragraph</p>

<!-- Code -->
<code class="font-mono text-sm bg-slate-100 px-2 py-1 rounded">code snippet</code>
```

```


## product-plan/shell/components/AppShell.tsx

```
import { Menu } from 'lucide-react'
import { useState } from 'react'
import { MainNav, type NavigationItem } from './MainNav'
import { UserMenu } from './UserMenu'

export interface AppShellProps {
  children: React.ReactNode
  navigationItems: NavigationItem[]
  user?: { name: string; avatarUrl?: string }
  onNavigate?: (href: string) => void
  onLogout?: () => void
}

export function AppShell({
  children,
  navigationItems,
  user,
  onNavigate,
  onLogout,
}: AppShellProps) {
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false)

  return (
    <div className="min-h-screen bg-slate-50 dark:bg-slate-950">
      {/* Header Bar */}
      <header className="fixed top-0 left-0 right-0 h-16 bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 z-30">
        <div className="flex items-center justify-between h-full px-4">
          <div className="flex items-center gap-4">
            {/* Mobile Menu Button */}
            <button
              onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
              className="lg:hidden p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors"
            >
              <Menu className="w-5 h-5 text-slate-600 dark:text-slate-400" />
            </button>

            {/* Logo */}
            <div className="flex items-center gap-2">
              <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-violet-500 to-violet-600 flex items-center justify-center">
                <span className="text-white font-bold text-sm">DS</span>
              </div>
              <span className="font-bold text-lg text-slate-900 dark:text-slate-100 hidden sm:block">
                DomainSmith
              </span>
            </div>
          </div>

          {/* User Menu */}
          <UserMenu user={user} onLogout={onLogout} />
        </div>
      </header>

      {/* Mobile Menu Overlay */}
      {isMobileMenuOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-40 lg:hidden"
          onClick={() => setIsMobileMenuOpen(false)}
        />
      )}

      {/* Sidebar */}
      <aside
        className={`
          fixed top-16 left-0 bottom-0 w-64 bg-white dark:bg-slate-900 border-r border-slate-200 dark:border-slate-800
          transition-transform duration-200 z-40
          lg:translate-x-0
          ${isMobileMenuOpen ? 'translate-x-0' : '-translate-x-full'}
        `}
      >
        <div className="p-4">
          <MainNav
            items={navigationItems}
            onNavigate={onNavigate}
            onCloseMobile={() => setIsMobileMenuOpen(false)}
          />
        </div>
      </aside>

      {/* Main Content */}
      <main className="pt-16 lg:pl-64">
        <div className="min-h-[calc(100vh-4rem)]">
          {children}
        </div>
      </main>
    </div>
  )
}

```


## product-plan/shell/components/index.ts

```
export { AppShell } from './AppShell'
export type { AppShellProps } from './AppShell'

export { MainNav } from './MainNav'
export type { MainNavProps, NavigationItem } from './MainNav'

export { UserMenu } from './UserMenu'
export type { UserMenuProps } from './UserMenu'

```


## product-plan/shell/components/MainNav.tsx

```
import { ChevronLeft, type LucideIcon, Layout as DefaultIcon } from 'lucide-react'

export interface NavigationItem {
  label: string
  href: string
  icon?: LucideIcon
  isActive?: boolean
}

export interface MainNavProps {
  items: NavigationItem[]
  isCollapsed?: boolean
  onNavigate?: (href: string) => void
  onCloseMobile?: () => void
}

export function MainNav({ items, isCollapsed = false, onNavigate, onCloseMobile }: MainNavProps) {
  const handleClick = (href: string) => {
    onNavigate?.(href)
    onCloseMobile?.()
  }

  return (
    <nav className="flex flex-col gap-1">
      {items.map((item) => {
        const Icon = item.icon || DefaultIcon
        const activeClass = item.isActive
          ? 'bg-violet-50 dark:bg-violet-950/30 text-violet-700 dark:text-violet-300 border-l-4 border-violet-500'
          : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-slate-200 border-l-4 border-transparent'

        return (
          <button
            key={item.href}
            onClick={() => handleClick(item.href)}
            className={`flex items-center gap-3 px-4 py-2.5 rounded-r-lg transition-all duration-150 ${activeClass}`}
          >
            <Icon className="w-5 h-5 flex-shrink-0" />
            {!isCollapsed && (
              <span className="font-medium text-sm">{item.label}</span>
            )}
          </button>
        )
      })}
    </nav>
  )
}

```


## product-plan/shell/components/UserMenu.tsx

```
import { LogOut, Settings, User } from 'lucide-react'
import { useState } from 'react'

export interface UserMenuProps {
  user?: {
    name: string
    avatarUrl?: string
  }
  onLogout?: () => void
}

export function UserMenu({ user, onLogout }: UserMenuProps) {
  const [isOpen, setIsOpen] = useState(false)

  const initials = user?.name
    .split(' ')
    .map((n) => n[0])
    .join('')
    .toUpperCase()
    .slice(0, 2)

  return (
    <div className="relative">
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors"
      >
        {user?.avatarUrl ? (
          <img
            src={user.avatarUrl}
            alt={user.name}
            className="w-8 h-8 rounded-full object-cover"
          />
        ) : (
          <div className="w-8 h-8 rounded-full bg-violet-100 dark:bg-violet-900 flex items-center justify-center">
            <span className="text-xs font-medium text-violet-700 dark:text-violet-300">
              {initials}
            </span>
          </div>
        )}
        <span className="text-sm font-medium text-slate-700 dark:text-slate-300">
          {user?.name}
        </span>
      </button>

      {isOpen && (
        <>
          <div
            className="fixed inset-0 z-10"
            onClick={() => setIsOpen(false)}
          />
          <div className="absolute right-0 top-full mt-2 w-56 bg-white dark:bg-slate-900 rounded-lg shadow-lg border border-slate-200 dark:border-slate-800 z-20">
            <div className="p-3 border-b border-slate-200 dark:border-slate-800">
              <p className="text-xs text-slate-500 dark:text-slate-400">
                Signed in as
              </p>
              <p className="text-sm font-medium text-slate-900 dark:text-slate-100">
                {user?.name}
              </p>
            </div>
            <div className="p-1">
              <button className="flex items-center gap-3 w-full px-3 py-2 rounded-md text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">
                <User className="w-4 h-4" />
                Profile
              </button>
              <button className="flex items-center gap-3 w-full px-3 py-2 rounded-md text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">
                <Settings className="w-4 h-4" />
                Settings
              </button>
              <button
                onClick={onLogout}
                className="flex items-center gap-3 w-full px-3 py-2 rounded-md text-sm text-amber-600 dark:text-amber-400 hover:bg-amber-50 dark:hover:bg-amber-950/20 transition-colors"
              >
                <LogOut className="w-4 h-4" />
                Logout
              </button>
            </div>
          </div>
        </>
      )}
    </div>
  )
}

```


## product-plan/shell/README.md

```
# Application Shell

The DomainSmith application shell provides the persistent chrome that wraps all sections of the platform.

## Overview

The shell uses a sidebar navigation layout with:
- Fixed header bar (64px height) with logo and user menu
- Fixed sidebar (256px width) on desktop with navigation items
- Collapsible sidebar on mobile with hamburger menu
- Main content area taking remaining space

## Navigation Structure

The navigation includes the following items:

| Label | Route | Icon |
|-------|-------|------|
| Dashboard | `/` | Layout |
| Prompt Library | `/prompt-library` | FileText |
| Agent Builder | `/agent-builder` | Wrench |
| Agent Runtime | `/agent-runtime` | Play |
| Workspaces | `/workspaces` | Users |

## Components

- **AppShell** — Main layout wrapper that orchestrates header, sidebar, and content
- **MainNav** — Navigation component with items, active states, and mobile handling
- **UserMenu** — User dropdown menu with avatar, profile, settings, and logout

## Props Reference

### AppShell

```typescript
interface AppShellProps {
  children: React.ReactNode
  navigationItems: NavigationItem[]
  user?: { name: string; avatarUrl?: string }
  onNavigate?: (href: string) => void
  onLogout?: () => void
}
```

### MainNav

```typescript
interface MainNavProps {
  items: NavigationItem[]
  isCollapsed?: boolean
  onNavigate?: (href: string) => void
  onCloseMobile?: () => void
}
```

### UserMenu

```typescript
interface UserMenuProps {
  user?: { name: string; avatarUrl?: string }
  onLogout?: () => void
}
```

## Design Tokens

- **Active nav:** violet background with left accent border (4px)
- **Hover:** slate-100/slate-800 backgrounds
- **Header:** white with slate-200 border
- **Sidebar:** white with slate-200 border on right
- **Logo:** violet-500 to violet-600 gradient

## Responsive Behavior

- **Desktop (1024px+):** Fixed sidebar visible, user menu top right
- **Tablet (768px-1023px):** Same as desktop
- **Mobile (<768px):** Sidebar hidden, hamburger menu in header, overlay backdrop when open

```


## product-plan/instructions/incremental/02-prompt-library.md

```
# Milestone 2: Prompt Library

> **Provide alongside:** `product-plan/product-overview.md`
> **Prerequisites:** Milestone 1 (Shell) complete

---

## About This Handoff

**What you're receiving:**
- Finished UI designs (React components with full styling)
- Product requirements and user flow specifications
- Design system tokens (colors, typography)
- Sample data showing the shape of data components expect
- Test specs focused on user-facing behavior

**Your job:**
- Integrate these components into your application
- Wire up callback props to your routing and business logic
- Replace sample data with real data from your backend
- Implement loading, error, and empty states

The components are props-based — they accept data and fire callbacks. How you architect the backend, data layer, and business logic is up to you.

---

## Goal

Implement the Prompt Library feature — the core workspace where experts author, organize, and manage prompt fragments as a filesystem-based taxonomy of .md files.

## Overview

The Prompt Library provides a split-pane interface with a hierarchical file tree on the left and a WYSIWYG editor on the right. Domain experts create and modify prompt fragments as markdown files organized in folders, with support for frontmatter metadata. This is the foundational content management system for all domain knowledge that will be used to build specialized agents.

**Key Functionality:**
- Browse the hierarchical file tree to explore prompt fragments by domain or category
- View any file by clicking it in the tree to load its content in the editor pane
- Create new files with the "New" button, providing filename and parent folder location
- Edit file content in the WYSIWYG editor with markdown support
- Create folders for organizing related fragments
- Rename or move files and folders through context menus
- Delete files or folders from the library
- Expand and collapse folders in the tree view

## Components Provided

Copy the section components from `product-plan/sections/prompt-library/components/`:

- `PromptLibrary.tsx` — Main split-pane component with file tree and editor

## Props Reference

The components expect these data shapes (see `types.ts` for full definitions):

**Data props:**

- `fileSystem: Directory` — The complete file system tree structure
- `selectedFile: PromptFragment | null` — Currently selected file (if any)
- `expandedFolders: string[]` — Array of folder paths that should be expanded
- `unsavedChanges: boolean` — Whether the current editor has unsaved changes
- `isLoading?: boolean` — Whether a file operation is in progress
- `error?: string | null` — Error message to display

**Callback props:**

| Callback | Triggered When |
|----------|---------------|
| `onSelectFile` | User clicks a file in the tree |
| `onToggleFolder` | User clicks to expand/collapse a folder |
| `onEditContent` | User types in the editor |
| `onSave` | User clicks save or presses Ctrl+S |
| `onCreateFile` | User submits the new file form |
| `onCreateFolder` | User submits the new folder form |
| `onRename` | User renames a node |
| `onMove` | User moves a node to a new parent |
| `onDelete` | User deletes a node |

## Expected User Flows

When fully implemented, users should be able to complete these flows:

### Flow 1: Browse and View a Fragment

1. User navigates to Prompt Library
2. User sees the hierarchical file tree on the left with folders expanded
3. User clicks on a file (e.g., "dns-concepts.md")
4. **Outcome:** File content loads in the editor pane on the right

### Flow 2: Create a New Prompt Fragment

1. User clicks the "New" button in the toolbar
2. User selects "File" from the dropdown
3. User enters filename (e.g., "firewall-rules.md")
4. User selects parent folder from dropdown
5. User clicks "Create"
6. **Outcome:** New file appears in tree, editor opens with blank content, focus is in editor

### Flow 3: Edit and Save a Fragment

1. User opens a file from the tree
2. User makes changes in the WYSIWYG editor
3. User sees unsaved changes indicator (dot or asterisk)
4. User clicks "Save" button or presses Ctrl+S
5. **Outcome:** Changes are saved, unsaved indicator disappears

### Flow 4: Create a New Folder

1. User clicks the "New" button
2. User selects "Folder" from the dropdown
3. User enters folder name (e.g., "vpn")
4. User selects parent location
5. User clicks "Create"
6. **Outcome:** New folder appears in tree at specified location

### Flow 5: Delete a Fragment

1. User right-clicks on a file in the tree
2. User selects "Delete" from context menu
3. User confirms deletion in modal
4. **Outcome:** File is removed from tree, editor clears if that file was selected

## Empty States

The components include empty state designs. Make sure to handle:

- **No file selected:** Show helpful message in editor pane when no file is selected
- **Empty library:** Show CTA to create first fragment when library is empty
- **Empty folder:** Handle folders with no children (expandable but shows empty state)

## Testing

See `product-plan/sections/prompt-library/tests.md` for UI behavior test specs covering:
- User flow success and failure paths
- File tree navigation and editing
- Empty state rendering
- Component interactions and edge cases

## Files to Reference

- `product-plan/sections/prompt-library/README.md` — Feature overview and design intent
- `product-plan/sections/prompt-library/tests.md` — UI behavior test specs
- `product-plan/sections/prompt-library/types.ts` — TypeScript interfaces
- `product-plan/sections/prompt-library/sample-data.json` — Test data

## Done When

- [ ] Components render with real file system data
- [ ] Empty states display properly when no file is selected
- [ ] All callback props are wired to working functionality
- [ ] User can complete all expected flows end-to-end
- [ ] File tree expand/collapse works smoothly
- [ ] Unsaved changes indicator appears/disappears correctly
- [ ] Responsive on mobile

```


## product-plan/sections/prompt-library/tests.md

```
# Test Specs: Prompt Library

These test specs are **framework-agnostic**. Adapt them to your testing setup (Jest, Vitest, Playwright, Cypress, React Testing Library, etc.).

## Overview

The Prompt Library is a filesystem-based workspace where domain experts author, organize, and manage prompt fragments as a hierarchical taxonomy of markdown files. The split-pane interface has a file tree sidebar and a WYSIWYG editor.

---

## User Flow Tests

### Flow 1: Browse and View a Fragment

**Scenario:** User navigates the file tree and views a prompt fragment's content

#### Success Path

**Setup:**
- File system contains directories: `/networking/basics/` with file `dns-concepts.md`
- File tree is loaded and rendered
- No file is currently selected

**Steps:**
1. User navigates to the Prompt Library page
2. User sees the file tree on the left with "networking" folder
3. User clicks to expand the "networking" folder
4. User sees "basics" subfolder and expands it
5. User clicks on "dns-concepts.md" file
6. User sees the file content load in the editor pane on the right

**Expected Results:**
- [ ] File tree shows "networking" folder with expand/collapse icon
- [ ] Expanding "networking" reveals "basics" subfolder
- [ ] Clicking "dns-concepts.md" highlights the file as selected
- [ ] Editor pane displays the markdown content with proper formatting
- [ ] Editor title shows "dns-concepts.md"
- [ ] No unsaved changes indicator is visible

### Flow 2: Create a New Prompt Fragment

**Scenario:** User creates a new prompt fragment in an existing folder

#### Success Path

**Setup:**
- File system contains `/networking/basics/` directory
- No file is currently selected

**Steps:**
1. User clicks the "New" button in the toolbar
2. User selects "File" from the dropdown menu
3. User enters filename "firewall-rules.md" in the filename input
4. User selects "/networking/basics" as parent folder from dropdown
5. User clicks "Create" button
6. New file appears in tree under "basics" folder
7. Editor opens with blank content, cursor ready for typing

**Expected Results:**
- [ ] New file modal appears with "Create File" title
- [ ] Filename input is present and focused
- [ ] Parent folder dropdown shows available directories
- [ ] After clicking "Create", new file appears in tree at correct location
- [ ] "firewall-rules.md" is highlighted as selected
- [ ] Editor pane shows empty/blank state ready for content
- [ ] Unsaved changes indicator is not visible (no changes yet)

#### Failure Path: Filename Already Exists

**Steps:**
1. User clicks "New" → "File"
2. User enters filename "dns-concepts.md" (already exists)
3. User selects parent folder
4. User clicks "Create"

**Expected Results:**
- [ ] Error message appears: "A file with this name already exists"
- [ ] Modal remains open, user can change filename
- [ ] No new file is created in the tree

#### Failure Path: Empty Filename

**Steps:**
1. User clicks "New" → "File"
2. User leaves filename field empty
3. User clicks "Create"

**Expected Results:**
- [ ] Validation error shows: "Filename is required"
- [ ] Create button is disabled or shows error
- [ ] Modal remains open

### Flow 3: Edit and Save a Fragment

**Scenario:** User modifies an existing prompt fragment and saves changes

#### Success Path

**Setup:**
- File `/networking/basics/dns-concepts.md` is selected and loaded
- File contains existing content

**Steps:**
1. User makes changes to content in the editor
2. User sees unsaved changes indicator (dot or asterisk next to filename)
3. User clicks "Save" button (or presses Ctrl+S)
4. Save completes successfully
5. Unsaved changes indicator disappears

**Expected Results:**
- [ ] Editor allows typing and content modification
- [ ] Unsaved changes indicator appears after first edit
- [ ] Clicking "Save" triggers save callback with modified content
- [ ] After successful save, indicator disappears
- [ ] Toast/notification shows "File saved successfully"

#### Failure Path: Save Error

**Steps:**
1. User edits file content
2. Backend returns error (e.g., network failure, permission denied)
3. User clicks "Save"

**Expected Results:**
- [ ] Error message appears: "Failed to save. Please try again."
- [ ] Unsaved changes indicator remains visible
- [ ] Editor content is preserved (not cleared)

### Flow 4: Create a New Folder

**Scenario:** User creates a new folder for organizing fragments

#### Success Path

**Setup:**
- File system exists with `/networking/` directory

**Steps:**
1. User clicks "New" button
2. User selects "Folder" from dropdown
3. User enters folder name "vpn" in the input
4. User selects "/networking" as parent location
5. User clicks "Create"
6. New folder appears in tree

**Expected Results:**
- [ ] New folder modal appears with "Create Folder" title
- [ ] Folder name input is present and focused
- [ ] Parent location dropdown shows available directories
- [ ] After clicking "Create", "vpn" folder appears under "networking"
- [ ] Folder shows folder icon, not file icon
- [ ] Folder can be expanded (even though empty)

### Flow 5: Delete a Fragment

**Scenario:** User deletes a prompt fragment with confirmation

#### Success Path

**Setup:**
- File `/networking/basics/dns-concepts.md` exists
- File is currently selected

**Steps:**
1. User right-clicks on "dns-concepts.md" in the tree
2. Context menu appears with options: Rename, Move, Delete
3. User clicks "Delete"
4. Confirmation modal appears: "Are you sure you want to delete dns-concepts.md?"
5. User clicks "Delete" to confirm
6. File is removed from tree
7. Editor pane shows empty state (no file selected)

**Expected Results:**
- [ ] Right-click shows context menu at cursor position
- [ ] Delete option is clearly labeled
- [ ] Confirmation modal shows filename and warning
- [ ] After confirmation, file disappears from tree
- [ ] If deleted file was selected, editor clears
- [ ] Tree updates to reflect new structure

---

## Empty State Tests

### No File Selected Empty State

**Scenario:** No file is currently selected in the tree

**Setup:**
- File system is loaded with content
- No file has been clicked/selected yet

**Expected Results:**
- [ ] Editor pane shows "No file selected" message
- [ ] Helpful text: "Select a file from the tree to view or edit its content"
- [ ] Placeholder illustration or icon is visible
- [ ] Save button is disabled or hidden

### Empty Library Empty State

**Scenario:** The library is completely empty (no files or folders)

**Setup:**
- File system has no nodes (root is empty)

**Expected Results:**
- [ ] Tree area shows "Your library is empty" message
- [ ] Helpful text: "Create your first prompt fragment to get started"
- [ ] Primary CTA button: "Create Fragment" opens new file modal
- [ ] No expand/collapse controls are visible

### Empty Folder State

**Scenario:** A folder exists but contains no children

**Setup:**
- Folder `/templates/` exists with empty children array

**Expected Results:**
- [ ] Folder appears in tree and can be expanded
- [ ] When expanded, shows "Empty folder" message or no children
- [ ] Context menu allows creating new files within this folder

---

## Component Interaction Tests

### File Tree

**Renders correctly:**
- [ ] Shows folders with folder icons
- [ ] Shows files with file icons
- [ ] Folders have expand/collapse chevron icons
- [ ] Selected file has highlight/violet background
- [ ] Directory config metadata shows custom labels/colors if present

**User interactions:**
- [ ] Clicking expand/collapse toggles folder visibility
- [ ] Clicking a file selects it and loads content
- [ ] Right-click shows context menu (Rename, Move, Delete)
- [ ] Tree supports keyboard navigation (arrow keys, Enter)

### Editor Pane

**Renders correctly:**
- [ ] Shows filename in header when file is selected
- [ ] Displays markdown content with proper formatting
- [ ] Frontmatter metadata is displayed or accessible
- [ ] Toolbar shows Save button (enabled/disabled based on changes)

**User interactions:**
- [ ] Typing in editor updates content and shows unsaved indicator
- [ ] Clicking Save triggers save callback
- [ ] Ctrl+S keyboard shortcut triggers save
- [ ] Editor supports markdown rendering (headings, lists, code blocks)

---

## Edge Cases

- [ ] Handles very long filenames with text truncation
- [ ] Handles very deep folder nesting (10+ levels)
- [ ] Handles filenames with special characters
- [ ] Preserves expanded/collapsed state when switching between files
- [ ] Handles concurrent editing conflicts (if applicable)
- [ ] Handles large files (1000+ lines) without performance issues
- [ ] Transition from empty to populated after creating first file
- [ ] Transition from populated to empty after deleting last file

---

## Accessibility Checks

- [ ] All interactive elements are keyboard accessible
- [ ] Tree has proper ARIA roles and attributes
- [ ] Focus management works when opening/closing modals
- [ ] Error messages are announced to screen readers
- [ ] Editor has proper label and instructions

```


## product-plan/sections/prompt-library/README.md

```
# Prompt Library

## Overview

The Prompt Library is a filesystem-based workspace where experts author, organize, and manage prompt fragments as a hierarchical taxonomy of markdown files. Users navigate a split-pane interface with an expandable file tree on the left and a WYSIWYG editor on the right for creating and editing prompt content.

## User Flows

- **Browse library** — Navigate the hierarchical file tree to explore prompt fragments by domain or category
- **View fragment** — Click a file in the tree to load its content in the editor pane for reading
- **Create fragment** — Click "New", provide a filename and location, then open in editor
- **Edit fragment** — Make changes to content in the WYSIWYG editor and save
- **Create folder** — Add new directories to the taxonomy for organization
- **Rename/move** — Rename files or folders, or move them to different locations in the tree
- **Delete** — Remove files or folders from the library

## Design Decisions

- Split-pane layout provides constant context — users can see the file tree while editing
- WYSIWYG editor (not raw markdown) lowers barrier for non-technical domain experts
- Frontmatter metadata supports categorization and discovery without rigid schemas
- File system metaphor is familiar to most users and maps well to mental models of knowledge organization
- Unsaved changes indicator prevents accidental data loss

## Data Shapes

**Entities:**
- `Directory` — Folders containing child nodes with optional config metadata
- `PromptFragment` — Markdown files with content and optional frontmatter
- `FileSystemNode` — Union type for either directories or files
- `DirectoryConfig` — Metadata from config.json (label, description, icon, color)
- `PromptFrontmatter` — YAML frontmatter from markdown files (title, tags, author, etc.)

**From global entities:** Workspace, User

## Visual Reference

See `screenshot.png` for the target UI design.

## Components Provided

- `PromptLibrary` — Main split-pane component with file tree sidebar and editor panel

## Callback Props

| Callback | Triggered When |
|----------|---------------|
| `onSelectFile` | User clicks a file in the tree |
| `onToggleFolder` | User clicks to expand/collapse a folder |
| `onEditContent` | User types in the editor |
| `onSave` | User clicks save or presses Ctrl+S |
| `onCreateFile` | User submits the new file form |
| `onCreateFolder` | User submits the new folder form |
| `onRename` | User renames a node |
| `onMove` | User moves a node to a new parent |
| `onDelete` | User deletes a node |

```


## product-plan/sections/prompt-library/types.ts

```
/**
 * Type of node in the file system
 */
export type NodeType = 'directory' | 'file';

/**
 * Metadata configuration stored in a directory's config.json file
 */
export interface DirectoryConfig {
  /** Human-readable label for the directory */
  label?: string;
  /** Description of the directory's purpose */
  description?: string;
  /** Icon identifier for UI rendering */
  icon?: string;
  /** Color for visual distinction in UI */
  color?: string;
  /** Additional custom metadata properties */
  [key: string]: unknown;
}

/**
 * Frontmatter metadata from a prompt fragment's markdown file
 */
export interface PromptFrontmatter {
  /** Human-readable title */
  title?: string;
  /** Category for organization */
  category?: string;
  /** Tags for filtering and discovery */
  tags?: string[];
  /** Author identifier */
  author?: string;
  /** ISO date string of creation */
  created?: string;
  /** ISO date string of last modification */
  modified?: string;
  /** Severity or priority level */
  severity?: 'low' | 'medium' | 'high';
  /** Additional custom properties */
  [key: string]: unknown;
}

/**
 * A prompt fragment file in the library
 */
export interface PromptFragment {
  /** Unique identifier for the fragment */
  id: string;
  /** Filename including extension */
  name: string;
  /** Node type discriminator */
  type: 'file';
  /** Full path from root */
  path: string;
  /** Optional frontmatter metadata */
  frontmatter?: PromptFrontmatter;
  /** Markdown content of the prompt */
  content: string;
}

/**
 * A directory that can contain other nodes
 */
export interface Directory {
  /** Unique identifier for the directory */
  id: string;
  /** Directory name */
  name: string;
  /** Node type discriminator */
  type: 'directory';
  /** Full path from root */
  path: string;
  /** Optional directory metadata from config.json */
  config?: DirectoryConfig;
  /** Child nodes (directories and/or files) */
  children?: FileSystemNode[];
}

/**
 * Union type for any node in the file system tree
 */
export type FileSystemNode = Directory | PromptFragment;

/**
 * New file form data for creation modal
 */
export interface NewFileForm {
  /** Filename with .md extension */
  filename: string;
  /** Parent directory path where file will be created */
  parentPath: string;
}

/**
 * New folder form data for creation modal */
export interface NewFolderForm {
  /** Folder name (no spaces, URL-friendly) */
  folderName: string;
  /** Parent directory path where folder will be created */
  parentPath: string;
}

/**
 * Context menu action type
 */
export type ContextMenuAction = 'rename' | 'move' | 'delete' | 'duplicate';

/**
 * Props for the Prompt Library screen component
 */
export interface PromptLibraryProps {
  /** The complete file system tree structure */
  fileSystem: Directory;
  /** Currently selected file (if any) */
  selectedFile: PromptFragment | null;
  /** Array of folder paths that should be expanded in the tree */
  expandedFolders: string[];
  /** Whether the current editor has unsaved changes */
  unsavedChanges: boolean;
  /** Whether a file operation is in progress */
  isLoading?: boolean;
  /** Error message to display (if any) */
  error?: string | null;

  /** Callback when a file is selected in the tree */
  onSelectFile: (file: PromptFragment) => void;
  /** Callback when a folder is expanded/collapsed */
  onToggleFolder: (path: string) => void;
  /** Callback when file content is edited */
  onEditContent: (content: string) => void;
  /** Callback when changes are saved */
  onSave: () => void;
  /** Callback when a new file is created */
  onCreateFile: (form: NewFileForm) => void;
  /** Callback when a new folder is created */
  onCreateFolder: (form: NewFolderForm) => void;
  /** Callback when a node is renamed */
  onRename: (nodeId: string, newName: string) => void;
  /** Callback when a node is moved */
  onMove: (nodeId: string, newParentPath: string) => void;
  /** Callback when a node is deleted */
  onDelete: (nodeId: string) => void;
}

```


## product-plan/sections/prompt-library/sample-data.json

```
{
  "_meta": {
    "models": {
      "FileSystemNode": "A node in the file tree, representing either a directory or a prompt fragment file.",
      "Directory": "A folder that can contain other directories and/or prompt fragments, with optional metadata configuration.",
      "PromptFragment": "A markdown file containing prompt content with optional frontmatter metadata.",
      "DirectoryConfig": "Metadata configuration stored in a directory's config.json file."
    },
    "relationships": [
      "FileSystemNode is a union type of Directory and PromptFragment",
      "Directory contains children which are FileSystemNodes",
      "Directory has an optional DirectoryConfig for metadata",
      "PromptFragment contains markdown content with optional frontmatter"
    ]
  },
  "fileSystem": {
    "id": "root",
    "name": "Prompt Library",
    "type": "directory",
    "path": "/",
    "children": [
      {
        "id": "dir-networking",
        "name": "networking",
        "type": "directory",
        "path": "/networking",
        "config": {
          "label": "Networking",
          "description": "Prompt fragments for network infrastructure and connectivity domains",
          "icon": "network",
          "color": "#3b82f6"
        },
        "children": [
          {
            "id": "dir-networking-basics",
            "name": "basics",
            "type": "directory",
            "path": "/networking/basics",
            "config": {
              "label": "Network Fundamentals",
              "description": "Core networking concepts and terminology"
            },
            "children": [
              {
                "id": "frag-ip-addressing",
                "name": "ip-addressing.md",
                "type": "file",
                "path": "/networking/basics/ip-addressing.md",
                "frontmatter": {
                  "title": "IP Addressing Fundamentals",
                  "category": "basics",
                  "tags": ["ipv4", "ipv6", "subnetting"],
                  "author": "net-admin",
                  "created": "2024-01-15",
                  "modified": "2024-02-01"
                },
                "content": "# IP Addressing\n\nYou are an expert in IP addressing schemes. When discussing IP addresses:\n\n- Always distinguish between IPv4 and IPv6\n- Explain subnet masks clearly\n- Use CIDR notation for network prefixes\n- Clarify public vs private address ranges\n\n## IPv4 Ranges\n\n- Class A: 10.0.0.0/8 (private)\n- Class B: 172.16.0.0/12 (private)\n- Class C: 192.168.0.0/16 (private)"
              },
              {
                "id": "frag-dns-concepts",
                "name": "dns-concepts.md",
                "type": "file",
                "path": "/networking/basics/dns-concepts.md",
                "frontmatter": {
                  "title": "DNS Fundamentals",
                  "category": "basics",
                  "tags": ["dns", "resolution", "records"]
                },
                "content": "# DNS Concepts\n\nYou are a DNS specialist. When answering DNS questions:\n\n- Explain the hierarchy from root to TLD to authoritative\n- Describe record types clearly (A, AAAA, CNAME, MX, TXT, SRV)\n- Include TTL considerations\n- Mention caching behaviors at each level\n\n## Common Record Types\n\n- **A**: Maps hostname to IPv4\n- **AAAA**: Maps hostname to IPv6\n- **CNAME**: Alias to another hostname\n- **MX**: Mail server for a domain"
              }
            ]
          },
          {
            "id": "dir-networking-eduroam",
            "name": "eduroam",
            "type": "directory",
            "path": "/networking/eduroam",
            "config": {
              "label": "eduroam",
              "description": "eduroam federation and configuration"
            },
            "children": [
              {
                "id": "frag-eduroam-overview",
                "name": "overview.md",
                "type": "file",
                "path": "/networking/eduroam/overview.md",
                "frontmatter": {
                  "title": "eduroam Overview",
                  "category": "eduroam",
                  "tags": ["federation", "wifi", "roaming"]
                },
                "content": "# eduroam Overview\n\nYou are an eduroam federation expert. Key points:\n\n- eduroam is a global roaming service for research and education\n- Uses 802.1X authentication with RADIUS\n- Hierarchical RADIUS proxy structure\n- Users log in with home institution credentials\n\n## Architecture\n\nThe eduroam federation operates through a tree of RADIUS servers. When a user authenticates at a visited institution, the request is proxied up the tree to their home institution's RADIUS server for validation."
              }
            ]
          }
        ]
      },
      {
        "id": "dir-identity",
        "name": "identity",
        "type": "directory",
        "path": "/identity",
        "config": {
          "label": "Identity & Access",
          "description": "Identity management, authentication, and authorization prompts",
          "icon": "shield",
          "color": "#8b5cf6"
        },
        "children": [
          {
            "id": "frag-saml-intro",
            "name": "saml-introduction.md",
            "type": "file",
            "path": "/identity/saml-introduction.md",
            "frontmatter": {
              "title": "SAML 2.0 Introduction",
              "category": "federation",
              "tags": ["saml", "sso", "federation"]
            },
            "content": "# SAML 2.0 Introduction\n\nYou are a SAML federation specialist. Explain SAML concepts clearly:\n\n- SAML enables web Single Sign-On (SSO)\n- XML-based protocol for exchanging authentication data\n- Key roles: Service Provider (SP) and Identity Provider (IdP)\n- SAML assertions contain authentication statements\n\n## SAML Flow\n\n1. User accesses SP resource\n2. SP generates SAML request and redirects to IdP\n3. User authenticates at IdP\n4. IdP issues SAML response\n5. SP validates response and grants access"
          },
          {
            "id": "frag-oauth-flow",
            "name": "oauth-authorization-flow.md",
            "type": "file",
            "path": "/identity/oauth-authorization-flow.md",
            "frontmatter": {
              "title": "OAuth 2.0 Authorization",
              "category": "api-security",
              "tags": ["oauth", "authorization", "tokens"]
            },
            "content": "# OAuth 2.0 Authorization\n\nYou are an OAuth 2.0 expert. When discussing authorization:\n\n- Distinguish OAuth (delegated authorization) from authentication\n- Explain the four grant types clearly\n- Emphasize security considerations for tokens\n- Describe token lifecycle and revocation\n\n## Grant Types\n\n1. **Authorization Code** - Most secure, for server-side apps\n2. **Implicit** - Deprecated, for browser-based apps\n3. **Password Credentials** - Legacy, for trusted first-party apps\n4. **Client Credentials** - For service-to-service auth\n\nAlways use Authorization Code flow with PKCE when possible."
          },
          {
            "id": "frag-multi-factor",
            "name": "multi-factor-authentication.md",
            "type": "file",
            "path": "/identity/multi-factor-authentication.md",
            "frontmatter": {
              "title": "Multi-Factor Authentication",
              "category": "security",
              "tags": ["mfa", "2fa", "totp", "webauthn"]
            },
            "content": "# Multi-Factor Authentication\n\nYou are an MFA specialist. Key concepts:\n\n- MFA requires at least two independent authentication factors\n- Factors: something you know, have, are\n- TOTP (Time-based One-Time Password) uses shared secret + time\n- WebAuthn/FIDO2 provides phishing-resistant hardware-bound credentials\n\n## MFA Methods\n\n- **TOTP apps**: Google Authenticator, Authy\n- **SMS codes**: Less secure due to SIM swapping risks\n- **Hardware keys**: YubiKey, Titan - most secure\n- **Biometrics**: Fingerprint, Face ID - something you are"
          }
        ]
      },
      {
        "id": "dir-security",
        "name": "security",
        "type": "directory",
        "path": "/security",
        "config": {
          "label": "Security",
          "description": "Security policies, incident response, and best practices"
        },
        "children": [
          {
            "id": "dir-security-policies",
            "name": "policies",
            "type": "directory",
            "path": "/security/policies",
            "children": []
          },
          {
            "id": "frag-incident-response",
            "name": "incident-response-playbook.md",
            "type": "file",
            "path": "/security/incident-response-playbook.md",
            "frontmatter": {
              "title": "Incident Response Playbook",
              "category": "operations",
              "tags": ["incident", "response", "security"],
              "severity": "high"
            },
            "content": "# Incident Response Playbook\n\nYou are a security incident response expert. When handling incident discussions:\n\n- Follow the NIST incident response lifecycle\n- Emphasize documentation throughout\n- Prioritize containment and recovery\n- Conduct post-incident reviews\n\n## NIST Incident Response Lifecycle\n\n1. **Preparation** - Develop IR plan, train team, deploy tools\n2. **Detection/Analysis** - Identify incidents, determine scope\n3. **Containment** - Limit damage, preserve evidence\n4. **Eradication** - Remove root cause, clean systems\n5. **Recovery** - Restore operations, validate systems\n6. **Post-Incident** - Lessons learned, update procedures"
          }
        ]
      },
      {
        "id": "dir-templates",
        "name": "templates",
        "type": "directory",
        "path": "/templates",
        "config": {
          "label": "Templates",
          "description": "Reusable prompt templates and boilerplates"
        },
        "children": [
          {
            "id": "frag-template-agent",
            "name": "agent-template.md",
            "type": "file",
            "path": "/templates/agent-template.md",
            "frontmatter": {
              "title": "Agent Template",
              "category": "template",
              "tags": ["template", "boilerplate"]
            },
            "content": "# Agent Template\n\nUse this template when creating new agent prompt fragments:\n\n## Role\n\nDescribe the agent's role and expertise area.\n\n## Context\n\nProvide background information the agent should know.\n\n## Constraints\n\nList any limitations or rules the agent must follow.\n\n## Output Format\n\nSpecify how the agent should structure responses."
          }
        ]
      },
      {
        "id": "dir-archives",
        "name": "archives",
        "type": "directory",
        "path": "/archives",
        "config": {
          "label": "Archives",
          "description": "Deprecated or unused prompt fragments"
        },
        "children": []
      }
    ]
  },
  "selectedFile": {
    "id": "frag-dns-concepts",
    "name": "dns-concepts.md",
    "type": "file",
    "path": "/networking/basics/dns-concepts.md",
    "frontmatter": {
      "title": "DNS Fundamentals",
      "category": "basics",
      "tags": ["dns", "resolution", "records"],
      "author": "net-admin",
      "created": "2024-01-18",
      "modified": "2024-02-03"
    },
    "content": "# DNS Concepts\n\nYou are a DNS specialist. When answering DNS questions:\n\n- Explain the hierarchy from root to TLD to authoritative\n- Describe record types clearly (A, AAAA, CNAME, MX, TXT, SRV)\n- Include TTL considerations\n- Mention caching behaviors at each level\n\n## Common Record Types\n\n- **A**: Maps hostname to IPv4\n- **AAAA**: Maps hostname to IPv6\n- **CNAME**: Alias to another hostname\n- **MX**: Mail server for a domain"
  },
  "unsavedChanges": false,
  "expandedFolders": [
    "/networking",
    "/networking/basics",
    "/identity",
    "/security",
    "/templates"
  ]
}

```


## product-plan/instructions/incremental/03-agent-builder.md

```
# Milestone 3: Agent Builder

> **Provide alongside:** `product-plan/product-overview.md`
> **Prerequisites:** Milestone 1 (Shell) complete, Milestone 2 (Prompt Library) complete

---

## About This Handoff

**What you're receiving:**
- Finished UI designs (React components with full styling)
- Product requirements and user flow specifications
- Design system tokens (colors, typography)
- Sample data showing the shape of data components expect
- Test specs focused on user-facing behavior

**Your job:**
- Integrate these components into your application
- Wire up callback props to your routing and business logic
- Replace sample data with real data from your backend
- Implement loading, error, and empty states

The components are props-based — they accept data and fire callbacks. How you architect the backend, data layer, and business logic is up to you.

---

## Goal

Implement the Agent Builder feature — the form-centric control panel where users configure specialized agents by selecting domains and filling out auto-generated forms.

## Overview

The Agent Builder provides a split-view interface with a domain catalog sidebar on the left and a dynamic configuration form on the right. Users select one or more domains (expertise areas), and the system generates a form based on the combined schema. A live preview panel shows the assembled system prompt as users fill out the form. Users can save agent configurations for later use.

**Key Functionality:**
- Browse available domains in the sidebar catalog with descriptions, tags, and category groupings
- Select multiple domains to combine expertise areas
- Fill out dynamically-generated form fields based on selected domain schemas
- View live preview of the generated system prompt with estimated token count
- Save agent configurations with name and description
- Load and edit previously saved agent configurations
- Delete saved agent configurations
- Form validation prevents saving incomplete configurations

## Components Provided

Copy the section components from `product-plan/sections/agent-builder/components/`:

- `AgentBuilder.tsx` — Main component with domain catalog and configuration form
- `DomainCatalog.tsx` — Sidebar listing available domains
- `ConfigurationForm.tsx` — Dynamic form generated from domain schemas
- `PromptPreview.tsx` — Live preview of assembled system prompt
- `SavedAgentsList.tsx` — List of previously saved configurations
- `AgentHeader.tsx` — Header with new/save/load actions

## Props Reference

The components expect these data shapes (see `types.ts` for full definitions):

**Data props:**

- `domains: Domain[]` — Available domains to select from
- `savedAgentConfigs: AgentConfig[]` — Previously saved agent configurations
- `selectedDomainIds?: string[]` — Currently selected domain IDs
- `formValues?: FormValues` — Current form field values
- `loadedAgentId?: string | null` — Currently loaded agent for editing
- `promptPreview?: PromptPreview` — Live-generated preview
- `isLoading?: boolean` — Loading state
- `validationErrors?: Record<string, string>` — Validation errors by field ID

**Callback props:**

| Callback | Triggered When |
|----------|---------------|
| `onDomainsChange` | User selects/deselects domains |
| `onFieldValueChange` | User changes a form field value |
| `onGeneratePreview` | User requests preview update |
| `onSaveAgent` | User saves the agent configuration |
| `onLoadAgent` | User loads an existing agent |
| `onDeleteAgent` | User deletes a saved agent |
| `onNewAgent` | User clicks to create new agent |

## Expected User Flows

When fully implemented, users should be able to complete these flows:

### Flow 1: Create a New Agent

1. User opens Agent Builder
2. User browses domains in the catalog sidebar
3. User clicks on one or more domains (they highlight as selected)
4. Configuration form appears on the right with fields from selected domains
5. User fills in form fields (required fields marked)
6. User sees live prompt preview update as they type
7. User clicks "Save Agent" button
8. User enters agent name and description in modal
9. **Outcome:** Agent configuration is saved and appears in saved agents list

### Flow 2: Edit an Existing Agent

1. User opens Agent Builder
2. User clicks on a saved agent in the list
3. Form populates with previously saved values
4. User modifies domain selections or form values
5. User clicks "Save" to update
6. **Outcome:** Updated agent configuration is saved

### Flow 3: Browse Domains Without Saving

1. User opens Agent Builder
2. User explores different domain categories
3. User selects domains to see what form fields are generated
4. User fills in sample values to preview the prompt
5. User clicks "New Agent" to clear and start over
6. **Outcome:** Form is reset to empty state, no save occurs

## Empty States

The components include empty state designs. Make sure to handle:

- **No domains selected:** Show helpful message inviting user to select domains from catalog
- **No saved agents:** Show empty state in saved agents list when no configurations exist
- **Form validation:** Show inline errors when required fields are empty on save attempt

## Testing

See `product-plan/sections/agent-builder/tests.md` for UI behavior test specs covering:
- User flow success and failure paths
- Domain selection and form generation
- Prompt preview updates
- Save/load/delete operations
- Validation error handling

## Files to Reference

- `product-plan/sections/agent-builder/README.md` — Feature overview and design intent
- `product-plan/sections/agent-builder/tests.md` — UI behavior test specs
- `product-plan/sections/agent-builder/types.ts` — TypeScript interfaces
- `product-plan/sections/agent-builder/sample-data.json` — Test data with domains and saved agents

## Done When

- [ ] Components render with real domain data
- [ ] Domain multi-selection works with visual feedback
- [ ] Form fields generate correctly based on selected domains
- [ ] Live prompt preview updates as user types
- [ ] Save/load/delete operations work correctly
- [ ] Validation prevents saving incomplete configurations
- [ ] Empty states display appropriately
- [ ] Responsive on mobile

```


## product-plan/sections/agent-builder/tests.md

```
# Test Specs: Agent Builder

These test specs are **framework-agnostic**. Adapt them to your testing setup (Jest, Vitest, Playwright, Cypress, React Testing Library, etc.).

## Overview

The Agent Builder is a form-centric control panel where users configure specialized agents by selecting domains and filling out auto-generated forms. Features multi-domain selection, dynamic form generation, live prompt preview, and saved agent management.

---

## User Flow Tests

### Flow 1: Create a New Agent

**Scenario:** User creates a new agent by selecting domains and filling out the form

#### Success Path

**Setup:**
- Builder is loaded with available domains
- No agent is currently being edited (fresh state)
- Saved agents list may contain previous configurations

**Steps:**
1. User opens Agent Builder
2. User sees domain catalog on the left with categories (Security, Infrastructure, Compliance, etc.)
3. User clicks on "Cybersecurity" domain
4. User clicks on "Data Privacy" domain (multi-select)
5. Both domains show as selected with violet highlight
6. Configuration form appears on the right with fields from both domains
7. User fills in required fields:
   - "Assessment Scope" (textarea): "Customer-facing web application"
   - "Compliance Standards" (multiselect): Selects "SOC 2", "GDPR"
   - "Minimum Severity" (select): Selects "Medium"
   - "Jurisdictions" (multiselect): Selects "EU (GDPR)", "California (CCPA/CPRA)"
   - "Data Categories" (textarea): "User names, email addresses"
8. User sees prompt preview panel updating with generated prompt
9. User clicks "Save Agent" button
10. User enters agent name "Security Auditor" in modal
11. User enters description "Combined cybersecurity and data privacy agent"
12. User clicks "Save"
13. **Outcome:** New agent appears in saved agents list

**Expected Results:**
- [ ] Domain catalog shows all available domains grouped by category
- [ ] Clicking domains toggles selection state
- [ ] Multiple domains can be selected simultaneously
- [ ] Selected domains show visual indication (violet background/check icon)
- [ ] Form fields appear dynamically based on selected domains
- [ ] Required fields are marked with asterisk or label
- [ ] Prompt preview updates as user types
- [ ] Token count displays in preview panel
- [ ] Save button opens modal for name/description
- [ ] After save, agent appears in saved list with correct name

#### Failure Path: Validation Error on Save

**Steps:**
1. User selects one or more domains
2. User leaves required fields empty
3. User clicks "Save Agent"
4. User enters name and description
5. User clicks "Save" in modal

**Expected Results:**
- [ ] Validation errors appear inline on required fields
- [ ] Error message: "Please fill in all required fields"
- [ ] Modal closes, form remains open
- [ ] Agent is not saved to the list

### Flow 2: Edit an Existing Agent

**Scenario:** User loads a previously saved agent and modifies it

#### Success Path

**Setup:**
- Saved agents list contains "Security Auditor" agent
- Agent has existing domain selections and form values

**Steps:**
1. User opens Agent Builder
2. User sees saved agents list in sidebar
3. User clicks on "Security Auditor" in the list
4. Form populates with previously saved values
5. Selected domains (Cybersecurity, Data Privacy) show as selected
6. User changes "Minimum Severity" from "Medium" to "High"
7. User sees prompt preview update
8. User clicks "Save" button
9. **Outcome:** Agent configuration is updated with new values

**Expected Results:**
- [ ] Clicking saved agent loads its configuration
- [ ] All form fields populate with saved values
- [ ] Domain selections match saved configuration
- [ ] Prompt preview shows saved agent's prompt
- [ ] Modified after save shows updated timestamp
- [ ] Agent remains at same position in list (not re-added)

### Flow 3: Browse Domains Without Saving

**Scenario:** User explores domains to see available options

#### Success Path

**Setup:**
- Builder is loaded in fresh state

**Steps:**
1. User opens Agent Builder
2. User browses domain categories
3. User clicks "Cloud Architecture" to see form fields
4. User fills in sample values to preview prompt
5. User clicks "New Agent" button
6. **Outcome:** Form clears to empty state, no save occurs

**Expected Results:**
- [ ] Domain categories show as section headers
- [ ] Each domain shows description and tags
- [ ] Selecting domain shows its form fields immediately
- [ ] Preview updates as user enters sample values
- [ ] Clicking "New Agent" clears form without confirmation
- [ ] No agent is added to saved list

### Flow 4: Delete a Saved Agent

**Scenario:** User deletes a previously saved agent configuration

#### Success Path

**Setup:**
- Saved agents list contains "Draft SOC Analyst" agent

**Steps:**
1. User opens Agent Builder
2. User hovers over "Draft SOC Analyst" in saved list
3. User clicks delete icon that appears
4. Confirmation modal appears: "Delete this agent configuration?"
5. User clicks "Delete"
6. **Outcome:** Agent is removed from saved list

**Expected Results:**
- [ ] Delete icon appears on hover in saved list
- [ ] Confirmation modal shows agent name
- [ ] After confirmation, agent disappears from list
- [ ] If deleted agent was loaded, form clears

---

## Empty State Tests

### No Domains Selected Empty State

**Scenario:** User hasn't selected any domains yet

**Setup:**
- Builder is loaded in fresh state
- No domains are selected

**Expected Results:**
- [ ] Right panel shows "No domains selected" message
- [ ] Helpful text: "Select one or more domains from the catalog to configure your agent"
- [ ] Domain catalog on left is fully visible and interactive
- [ ] Save button is disabled

### No Saved Agents Empty State

**Scenario:** No agents have been saved yet

**Setup:**
- Saved agents list is empty

**Expected Results:**
- [ ] Saved agents section shows "No saved agents" message
- [ ] Helpful text: "Your saved agent configurations will appear here"
- [ ] Section doesn't occupy excessive space when empty

---

## Component Interaction Tests

### Domain Catalog

**Renders correctly:**
- [ ] Shows domains grouped by category
- [ ] Each domain shows name, description, tags
- [ ] Selected domains have violet background
- [ ] Categories show as headers (Security, Infrastructure, etc.)

**User interactions:**
- [ ] Clicking domain toggles selection
- [ ] Multiple domains can be selected
- [ ] Clicking selected domain deselects it

### Configuration Form

**Renders correctly:**
- [ ] Field labels match schema definitions
- [ ] Required fields are marked
- [ ] Field types render correctly (text, textarea, select, multiselect, toggle)
- [ ] Default values populate from schema

**User interactions:**
- [ ] Typing in text fields updates form state
- [ ] Selecting from dropdowns updates selection
- [ ] Toggle switches between on/off
- [ ] Validation shows on blur or save attempt

### Prompt Preview

**Renders correctly:**
- [ ] Shows generated system prompt text
- [ ] Shows token count estimate
- [ ] Shows which domains are included
- [ ] Panel can be expanded/collapsed

**User interactions:**
- [ ] Preview updates as form values change
- [ ] Expand/collapse toggles panel size

---

## Edge Cases

- [ ] Handles selecting all available domains
- [ ] Handles deselecting all domains (shows empty state)
- [ ] Handles very long text in textarea fields
- [ ] Handles many saved agents (10+) with scrolling
- [ ] Handles concurrent edits (if multiple users)
- [ ] Preserves form state when switching between saved agents
- [ ] Handles schema with no fields (edge case)
- [ ] Handles schema with all optional fields

---

## Accessibility Checks

- [ ] All form fields have associated labels
- [ ] Validation errors are announced to screen readers
- [ ] Domain selection uses proper ARIA attributes
- [ ] Keyboard navigation works for all interactive elements
- [ ] Focus management works when opening modals

```


## product-plan/sections/agent-builder/README.md

```
# Agent Builder

## Overview

A form-centric control panel where users configure specialized agents by selecting multiple domains and filling out auto-generated forms. The split-view interface displays a domain catalog sidebar alongside a dynamic configuration form, with live preview of the generated system prompt and ability to save agent configurations.

## User Flows

- **Create new agent** — Open the builder, select one or more domains from the catalog, configure form fields based on the combined schema, preview the generated prompt, and save the agent configuration
- **Load and edit existing agent** — Select a previously saved agent from the list, modify domain selections or form values, preview updated prompt, and save changes
- **Browse domains** — Explore available domains in the sidebar catalog with descriptions, tags, and form field previews before selecting

## Design Decisions

- Multi-domain selection allows combining expertise areas (e.g., cybersecurity + data privacy)
- Live preview provides immediate feedback on how form values affect the final prompt
- Form generation from schemas enables extensibility — new domains can be added without code changes
- Saved agents list supports quick iteration and version management
- Validation prevents incomplete configurations from being saved

## Data Shapes

**Entities:**
- `Domain` — Expertise areas with schema defining form fields and prompt template
- `DomainSchema` — Defines form fields (type, label, required, options, default)
- `SchemaField` — Individual form field definition
- `FormValues` — Map of field IDs to their values
- `AgentConfig` — Saved agent configuration with domains, values, and timestamps
- `PromptPreview` — Live-generated preview with assembled prompt and token count

**From global entities:** Workspace, User

## Visual Reference

See `screenshot.png` for the target UI design.

## Components Provided

- `AgentBuilder` — Main component orchestrating the builder interface
- `DomainCatalog` — Sidebar listing available domains by category
- `ConfigurationForm` — Dynamic form generated from domain schemas
- `PromptPreview` — Panel showing assembled system prompt
- `SavedAgentsList` — List of previously saved agent configurations
- `AgentHeader` — Header with new/save/load actions

## Callback Props

| Callback | Triggered When |
|----------|---------------|
| `onDomainsChange` | User selects/deselects domains from catalog |
| `onFieldValueChange` | User changes a form field value |
| `onGeneratePreview` | User requests prompt preview update |
| `onSaveAgent` | User saves the agent configuration |
| `onLoadAgent` | User loads an existing agent |
| `onDeleteAgent` | User deletes a saved agent configuration |
| `onNewAgent` | User clicks to create new agent (clear form) |

```


## product-plan/sections/agent-builder/types.ts

```
/**
 * Agent Builder Section Types
 *
 * Types for the agent builder interface where users configure
 * specialized agents by selecting domains and filling out forms.
 */

/**
 * A form field type within a domain's schema
 */
export type SchemaFieldType = 'text' | 'textarea' | 'select' | 'multiselect' | 'toggle';

/**
 * An available domain/expertise area that can be selected when building an agent
 */
export interface Domain {
  /** Unique identifier for the domain */
  id: string;
  /** Human-readable name */
  name: string;
  /** Description of what the domain covers */
  description: string;
  /** Category grouping (e.g., Security, Infrastructure) */
  category: string;
  /** Tags for searchability */
  tags: string[];
  /** Icon identifier for UI display */
  icon: string;
  /** Schema defining form fields for this domain */
  schema: DomainSchema;
  /** Template string for generating the system prompt */
  template: string;
}

/**
 * Schema that defines the form fields for a domain
 */
export interface DomainSchema {
  /** Array of field definitions */
  fields: SchemaField[];
}

/**
 * A single form field definition within a domain's schema
 */
export interface SchemaField {
  /** Unique identifier for the field */
  id: string;
  /** Type of form control */
  type: SchemaFieldType;
  /** Human-readable label */
  label: string;
  /** Placeholder text (for text inputs) */
  placeholder?: string;
  /** Whether the field is required */
  required: boolean;
  /** Default value */
  default: string | string[] | boolean;
  /** Options for select/multiselect fields */
  options?: string[];
}

/**
 * Category type derived from domain data
 */
export type DomainCategory = 'Security' | 'Infrastructure' | 'Compliance' | 'Development';

/**
 * Field values collected from the form - keyed by field ID
 */
export type FormFieldValue = string | string[] | boolean;

/**
 * Map of field IDs to their values
 */
export interface FormValues {
  [fieldId: string]: FormFieldValue;
}

/**
 * A saved agent configuration
 */
export interface AgentConfig {
  /** Unique identifier */
  id: string;
  /** Human-readable name */
  name: string;
  /** Description of the agent's purpose */
  description: string;
  /** IDs of selected domains */
  selectedDomains: string[];
  /** Form field values for all selected domains */
  formValues: FormValues;
  /** When the config was created */
  createdAt: string;
  /** When the config was last updated */
  updatedAt: string;
}

/**
 * Live-generated preview of the system prompt
 */
export interface PromptPreview {
  /** ID of the agent config */
  agentId: string;
  /** Names of domains included */
  domains: string[];
  /** The generated prompt text */
  generatedPrompt: string;
  /** Estimated token count */
  tokenCount: number;
  /** When the preview was last generated */
  lastGenerated: string;
}

/**
 * Props for the Agent Builder screen
 */
export interface AgentBuilderProps {
  /** Available domains to select from */
  domains: Domain[];
  /** Previously saved agent configurations */
  savedAgentConfigs: AgentConfig[];
  /** Currently selected domain IDs */
  selectedDomainIds?: string[];
  /** Current form values */
  formValues?: FormValues;
  /** Currently loaded agent config (for editing) */
  loadedAgentId?: string | null;
  /** Live prompt preview */
  promptPreview?: PromptPreview;
  /** Loading state */
  isLoading?: boolean;
  /** Validation errors by field ID */
  validationErrors?: Record<string, string>;
}

/**
 * Callback props for Agent Builder actions
 */
export interface AgentBuilderCallbacks {
  /** Called when one or more domains are selected/deselected */
  onDomainsChange: (domainIds: string[]) => void;
  /** Called when a form field value changes */
  onFieldValueChange: (fieldId: string, value: FormFieldValue) => void;
  /** Called to generate a new prompt preview */
  onGeneratePreview: () => void;
  /** Called to save the current agent configuration */
  onSaveAgent: (name: string, description: string) => void;
  /** Called to load an existing agent for editing */
  onLoadAgent: (agentId: string) => void;
  /** Called to delete a saved agent configuration */
  onDeleteAgent: (agentId: string) => void;
  /** Called to create a new agent (clear form) */
  onNewAgent: () => void;
}

```


## product-plan/sections/agent-builder/sample-data.json

```
{
  "_meta": {
    "models": {
      "Domain": "An available domain/expertise area that can be selected when building an agent. Each domain has a schema that defines the form fields for configuration.",
      "SchemaField": "A single form field definition within a domain's schema, defining the type, label, validation rules, and default value.",
      "AgentConfig": "A saved agent configuration containing the selected domains and filled form values that define an agent's behavior.",
      "PromptPreview": "A live-generated preview of the system prompt assembled from the selected domains and form values."
    },
    "relationships": [
      "Domain has many SchemaFields (defined by its schema)",
      "AgentConfig references many Domains (multi-selection)",
      "AgentConfig has many form field values corresponding to the schemas of selected domains",
      "PromptPreview is generated from AgentConfig by combining domain templates with form values"
    ]
  },
  "domains": [
    {
      "id": "domain-cybersecurity",
      "name": "Cybersecurity",
      "description": "Security assessment, vulnerability analysis, and threat detection expertise",
      "category": "Security",
      "tags": ["security", "audit", "compliance"],
      "icon": "shield",
      "schema": {
        "fields": [
          {
            "id": "scope",
            "type": "textarea",
            "label": "Assessment Scope",
            "placeholder": "Describe the systems, networks, or assets to be assessed...",
            "required": true,
            "default": ""
          },
          {
            "id": "complianceStandards",
            "type": "multiselect",
            "label": "Compliance Standards",
            "options": ["ISO 27001", "NIST CSF", "PCI DSS", "SOC 2", "GDPR", "HIPAA"],
            "required": false,
            "default": []
          },
          {
            "id": "severityThreshold",
            "type": "select",
            "label": "Minimum Severity Threshold",
            "options": ["Critical", "High", "Medium", "Low"],
            "required": true,
            "default": "High"
          },
          {
            "id": "reportFormat",
            "type": "select",
            "label": "Report Format",
            "options": ["Executive Summary", "Technical Detail", "Both"],
            "required": false,
            "default": "Both"
          }
        ]
      },
      "template": "You are a cybersecurity specialist focused on {{scope}}. Assess findings against {{complianceStandards}} standards. Report findings at {{severityThreshold}} severity level and above. Format output as {{reportFormat}}."
    },
    {
      "id": "domain-cloud-architecture",
      "name": "Cloud Architecture",
      "description": "AWS, Azure, and GCP infrastructure design and optimization",
      "category": "Infrastructure",
      "tags": ["cloud", "aws", "azure", "gcp", "devops"],
      "icon": "cloud",
      "schema": {
        "fields": [
          {
            "id": "primaryProvider",
            "type": "select",
            "label": "Primary Cloud Provider",
            "options": ["AWS", "Azure", "Google Cloud", "Multi-cloud"],
            "required": true,
            "default": "AWS"
          },
          {
            "id": "architectureType",
            "type": "select",
            "label": "Architecture Pattern",
            "options": ["Serverless", "Microservices", "Monolith", "Event-driven", "Hybrid"],
            "required": true,
            "default": "Microservices"
          },
          {
            "id": "costOptimization",
            "type": "toggle",
            "label": "Enable Cost Optimization Guidance",
            "required": false,
            "default": true
          },
          {
            "id": "scalingRequirements",
            "type": "textarea",
            "label": "Scaling Requirements",
            "placeholder": "Describe expected traffic patterns and scaling needs...",
            "required": false,
            "default": ""
          }
        ]
      },
      "template": "You are a cloud architecture consultant specializing in {{primaryProvider}}. Focus on {{architectureType}} patterns{{#if costOptimization}} with emphasis on cost optimization{{/if}}{{#if scalingRequirements}}. Scaling context: {{scalingRequirements}}{{/if}}."
    },
    {
      "id": "domain-data-privacy",
      "name": "Data Privacy",
      "description": "GDPR, CCPA, and global privacy regulation compliance guidance",
      "category": "Compliance",
      "tags": ["privacy", "gdpr", "ccpa", "compliance"],
      "icon": "lock",
      "schema": {
        "fields": [
          {
            "id": "jurisdictions",
            "type": "multiselect",
            "label": "Applicable Jurisdictions",
            "options": ["EU (GDPR)", "California (CCPA/CPRA)", "UK (UK GDPR)", "Canada (PIPEDA)", "Australia (Privacy Act)"],
            "required": true,
            "default": ["EU (GDPR)"]
          },
          {
            "id": "dataCategories",
            "type": "textarea",
            "label": "Data Categories Handled",
            "placeholder": "Describe types of personal data processed (e.g., health, financial, behavioral)...",
            "required": true,
            "default": ""
          },
          {
            "id": "includeDPIA",
            "type": "toggle",
            "label": "Include DPIA Framework",
            "required": false,
            "default": false
          },
          {
            "id": "dataSubjectRights",
            "type": "multiselect",
            "label": "Focus on Data Subject Rights",
            "options": ["Right to Access", "Right to Erasure", "Right to Portability", "Right to Object", "All Rights"],
            "required": false,
            "default": []
          }
        ]
      },
      "template": "You are a data privacy advisor for jurisdictions: {{jurisdictions}}. The organization handles: {{dataCategories}}.{{#if includeDPIA}} Include Data Protection Impact Assessment guidance.{{/if}}{{#if dataSubjectRights}} Pay special attention to: {{dataSubjectRights}}.{{/if}}"
    },
    {
      "id": "domain-network-engineering",
      "name": "Network Engineering",
      "description": "Network design, protocols, and troubleshooting expertise",
      "category": "Infrastructure",
      "tags": ["networking", "tcp/ip", "routing", "firewalls"],
      "icon": "network",
      "schema": {
        "fields": [
          {
            "id": "networkType",
            "type": "select",
            "label": "Network Type",
            "options": ["Enterprise LAN", "Data Center", "WAN/SD-WAN", "Cloud Network", "Industrial/OT"],
            "required": true,
            "default": "Enterprise LAN"
          },
          {
            "id": "protocols",
            "type": "multiselect",
            "label": "Relevant Protocols",
            "options": ["BGP", "OSPF", "MPLS", "VXLAN", "HTTP/HTTPS", "DNS", "DHCP"],
            "required": false,
            "default": []
          },
          {
            "id": "securityLevel",
            "type": "select",
            "label": "Security Posture",
            "options": ["Open/Permissive", "Standard", "High Security", "Air-gapped/Isolated"],
            "required": true,
            "default": "Standard"
          }
        ]
      },
      "template": "You are a network engineer for {{networkType}} environments{{#if protocols}} with expertise in: {{protocols}}{{/if}}. Security posture: {{securityLevel}}."
    },
    {
      "id": "domain-incident-response",
      "name": "Incident Response",
      "description": "Security incident handling, forensics, and recovery procedures",
      "category": "Security",
      "tags": ["ir", "forensics", "emergency"],
      "icon": "alert",
      "schema": {
        "fields": [
          {
            "id": "responseTier",
            "type": "select",
            "label": "Response Tier",
            "options": ["Tier 1 - Triage", "Tier 2 - Investigation", "Tier 3 - Forensics", "Tier 4 - Crisis Management"],
            "required": true,
            "default": "Tier 2 - Investigation"
          },
          {
            "id": "incidentTypes",
            "type": "multiselect",
            "label": "Incident Types",
            "options": ["Malware/Ransomware", "Phishing/BEC", "DDoS", "Insider Threat", "Data Breach", "Supply Chain"],
            "required": true,
            "default": []
          },
          {
            "id": "timeToObjectives",
            "type": "text",
            "label": "Time Objectives (MTTR/MTTD)",
            "placeholder": "e.g., MTTD < 1 hour, MTTR < 4 hours",
            "required": false,
            "default": ""
          },
          {
            "id": "includePlaybooks",
            "type": "toggle",
            "label": "Include Runbook Suggestions",
            "required": false,
            "default": true
          }
        ]
      },
      "template": "You are an incident response handler at {{responseTier}} level. Focus on: {{incidentTypes}}.{{#if timeToObjectives}} Time objectives: {{timeToObjectives}}.{{/if}}{{#if includePlaybooks}} Include specific runbook steps for each scenario.{{/if}}"
    },
    {
      "id": "domain-software-development",
      "name": "Software Development",
      "description": "Code review, architecture, and best practices across programming languages",
      "category": "Development",
      "tags": ["coding", "review", "architecture", "best-practices"],
      "icon": "code",
      "schema": {
        "fields": [
          {
            "id": "primaryLanguage",
            "type": "select",
            "label": "Primary Language",
            "options": ["Python", "JavaScript/TypeScript", "Java", "C#", "Go", "Rust", "Other"],
            "required": true,
            "default": "Python"
          },
          {
            "id": "focusAreas",
            "type": "multiselect",
            "label": "Focus Areas",
            "options": ["Code Quality", "Performance", "Security", "Testability", "Maintainability"],
            "required": false,
            "default": ["Code Quality"]
          },
          {
            "id": "frameworks",
            "type": "text",
            "label": "Relevant Frameworks",
            "placeholder": "e.g., React, Django, Spring Boot...",
            "required": false,
            "default": ""
          }
        ]
      },
      "template": "You are a software development expert specializing in {{primaryLanguage}}{{#if frameworks}} with {{frameworks}} framework experience{{/if}}. Prioritize: {{focusAreas}}."
    }
  ],
  "savedAgentConfigs": [
    {
      "id": "agent-001",
      "name": "Security Auditor",
      "description": "Combined cybersecurity and data privacy agent for compliance audits",
      "selectedDomains": ["domain-cybersecurity", "domain-data-privacy"],
      "formValues": {
        "scope": "Customer-facing web application and underlying database infrastructure",
        "complianceStandards": ["SOC 2", "GDPR", "ISO 27001"],
        "severityThreshold": "Medium",
        "reportFormat": "Both",
        "jurisdictions": ["EU (GDPR)", "California (CCPA/CPRA)"],
        "dataCategories": "User names, email addresses, payment information, and usage analytics",
        "includeDPIA": true,
        "dataSubjectRights": ["Right to Erasure", "Right to Access"]
      },
      "createdAt": "2025-10-15T09:30:00Z",
      "updatedAt": "2025-11-22T14:20:00Z"
    },
    {
      "id": "agent-002",
      "name": "Cloud Migration Advisor",
      "description": "Helps plan and execute cloud infrastructure migrations",
      "selectedDomains": ["domain-cloud-architecture", "domain-network-engineering"],
      "formValues": {
        "primaryProvider": "AWS",
        "architectureType": "Hybrid",
        "costOptimization": true,
        "scalingRequirements": "Seasonal traffic peaks of 10x baseline during holiday periods",
        "networkType": "Cloud Network",
        "protocols": ["BGP", "HTTP/HTTPS", "DNS"],
        "securityLevel": "High Security"
      },
      "createdAt": "2025-09-08T11:45:00Z",
      "updatedAt": "2025-09-08T11:45:00Z"
    },
    {
      "id": "agent-003",
      "name": "Incident Responder - Ransomware",
      "description": "Specialized responder for ransomware and malware incidents",
      "selectedDomains": ["domain-incident-response", "domain-cybersecurity"],
      "formValues": {
        "responseTier": "Tier 3 - Forensics",
        "incidentTypes": ["Malware/Ransomware", "Data Breach"],
        "timeToObjectives": "MTTD < 15 min, MTTR < 2 hours",
        "includePlaybooks": true,
        "scope": "Enterprise Windows environment with Active Directory",
        "complianceStandards": [],
        "severityThreshold": "Critical",
        "reportFormat": "Technical Detail"
      },
      "createdAt": "2025-11-05T16:00:00Z",
      "updatedAt": "2025-12-01T10:30:00Z"
    },
    {
      "id": "agent-004",
      "name": "DevOps Consultant",
      "description": "Full-stack development and cloud infrastructure guidance",
      "selectedDomains": ["domain-software-development", "domain-cloud-architecture"],
      "formValues": {
        "primaryLanguage": "Python",
        "focusAreas": ["Code Quality", "Security", "Testability"],
        "frameworks": "Django, Terraform, Kubernetes",
        "primaryProvider": "Multi-cloud",
        "architectureType": "Microservices",
        "costOptimization": true,
        "scalingRequirements": ""
      },
      "createdAt": "2025-10-20T08:15:00Z",
      "updatedAt": "2025-10-20T08:15:00Z"
    },
    {
      "id": "agent-005",
      "name": "Privacy Compliance Assistant",
      "description": "Focused guidance on GDPR and international privacy requirements",
      "selectedDomains": ["domain-data-privacy"],
      "formValues": {
        "jurisdictions": ["EU (GDPR)", "UK (UK GDPR)", "Canada (PIPEDA)"],
        "dataCategories": "Employee records including: personal identification, financial details, health information, and performance evaluations",
        "includeDPIA": true,
        "dataSubjectRights": ["All Rights"]
      },
      "createdAt": "2025-08-30T13:20:00Z",
      "updatedAt": "2025-11-10T09:45:00Z"
    },
    {
      "id": "agent-006",
      "name": "Network Security Architect",
      "description": "Designs secure network infrastructure with segmentation and access controls",
      "selectedDomains": ["domain-network-engineering", "domain-cybersecurity"],
      "formValues": {
        "networkType": "Data Center",
        "protocols": ["BGP", "OSPF", "VXLAN"],
        "securityLevel": "High Security",
        "scope": "Multi-tier data center with separate management, production, and DMZ zones",
        "complianceStandards": ["PCI DSS"],
        "severityThreshold": "High",
        "reportFormat": "Executive Summary"
      },
      "createdAt": "2025-11-18T15:50:00Z",
      "updatedAt": "2025-11-18T15:50:00Z"
    },
    {
      "id": "agent-007",
      "name": "Code Review Assistant",
      "description": "General-purpose code review focused on quality and security",
      "selectedDomains": ["domain-software-development"],
      "formValues": {
        "primaryLanguage": "TypeScript",
        "focusAreas": ["Security", "Code Quality", "Maintainability"],
        "frameworks": "React, Node.js, Express"
      },
      "createdAt": "2025-12-05T10:00:00Z",
      "updatedAt": "2025-12-05T10:00:00Z"
    },
    {
      "id": "agent-008",
      "name": "Draft SOC Analyst",
      "description": "Incomplete configuration - still being configured",
      "selectedDomains": ["domain-incident-response"],
      "formValues": {
        "responseTier": "Tier 1 - Triage",
        "incidentTypes": [],
        "timeToObjectives": "",
        "includePlaybooks": true
      },
      "createdAt": "2025-12-10T14:30:00Z",
      "updatedAt": "2025-12-10T14:30:00Z"
    }
  ],
  "promptPreview": {
    "agentId": "agent-001",
    "domains": ["Cybersecurity", "Data Privacy"],
    "generatedPrompt": "You are a cybersecurity specialist focused on Customer-facing web application and underlying database infrastructure. Assess findings against SOC 2, GDPR, ISO 27001 standards. Report findings at Medium severity level and above. Format output as Both.\n\nYou are a data privacy advisor for jurisdictions: EU (GDPR), California (CCPA/CPRA). The organization handles: User names, email addresses, payment information, and usage analytics. Include Data Protection Impact Assessment guidance. Pay special attention to: Right to Erasure, Right to Access.\n\nWhen responding, integrate both security and privacy perspectives. Always consider the compliance implications of security recommendations and the security requirements of privacy obligations.",
    "tokenCount": 245,
    "lastGenerated": "2025-11-22T14:20:00Z"
  }
}

```


## product-plan/instructions/incremental/04-agent-runtime.md

```
# Milestone 4: Agent Runtime

> **Provide alongside:** `product-plan/product-overview.md`
> **Prerequisites:** Milestone 1 (Shell) complete, Milestone 3 (Agent Builder) complete

---

## About This Handoff

**What you're receiving:**
- Finished UI designs (React components with full styling)
- Product requirements and user flow specifications
- Design system tokens (colors, typography)
- Sample data showing the shape of data components expect
- Test specs focused on user-facing behavior

**Your job:**
- Integrate these components into your application
- Wire up callback props to your routing and business logic
- Replace sample data with real data from your backend
- Implement loading, error, and empty states

The components are props-based — they accept data and fire callbacks. How you architect the backend, data layer, and business logic is up to you.

---

## Goal

Implement the Agent Runtime feature — a split-pane explorer for browsing, inspecting, and testing deployed agent instances.

## Overview

The Agent Runtime provides a split-pane interface with an agent list on the left and a detail pane on the right. Users can view agents that were generated from the Agent Builder, inspect their assembled system prompts, and run test conversations to validate agent behavior before production use. This is the testing and validation environment for all deployed agents.

**Key Functionality:**
- Browse all available agents in the left-pane list with name, domain/source, and timestamps
- Select an agent to view its details and conversation history
- Expand the collapsible panel to view the full generated system prompt
- Run test conversations by typing messages and receiving agent responses in real-time
- Switch between agents by clicking different items in the list
- Clear conversation history to start a new test session

## Components Provided

Copy the section components from `product-plan/sections/agent-runtime/components/`:

- `AgentRuntime.tsx` — Main split-pane component with agent list and detail view

## Props Reference

The components expect these data shapes (see `types.ts` for full definitions):

**Data props:**

- `agents: Agent[]` — List of all available agents
- `selectedAgentId: string | null` — Currently selected agent (null if none)
- `conversation: Conversation | null` — Active conversation for selected agent
- `isPromptPanelExpanded: boolean` — Whether system prompt panel is expanded
- `isLoading: boolean` — Whether a new message is being sent

**Callback props:**

| Callback | Triggered When |
|----------|---------------|
| `onSelectAgent` | User clicks an agent in the list |
| `onSendMessage` | User sends a new message |
| `onTogglePromptPanel` | User toggles system prompt panel visibility |
| `onClearConversation` | User clears the conversation |
| `onRestartAgent` | User restarts the agent |

## Expected User Flows

When fully implemented, users should be able to complete these flows:

### Flow 1: Test an Agent Conversation

1. User navigates to Agent Runtime
2. User sees list of agents on the left with their names and sources
3. User clicks on an agent (e.g., "GDPR Compliance Advisor")
4. User sees the conversation interface on the right
5. User types a message in the input field at the bottom
6. User presses Enter or clicks Send
7. **Outcome:** Message appears in conversation stream, agent response appears below it after a short delay

### Flow 2: View Agent's System Prompt

1. User selects an agent from the list
2. User clicks "View System Prompt" button or header
3. Panel expands showing the full assembled system prompt
4. **Outcome:** User can read the complete prompt that defines the agent's behavior

### Flow 3: Switch Between Agents

1. User has an active conversation with one agent
2. User clicks a different agent in the left list
3. **Outcome:** Detail pane updates to show the new agent's info and conversation history

### Flow 4: Clear and Restart Conversation

1. User has an existing conversation with messages
2. User clicks "Clear Conversation" button
3. **Outcome:** Conversation messages are cleared, ready for new test session

## Empty States

The components include empty state designs. Make sure to handle:

- **No agent selected:** Show helpful message in detail pane when no agent is selected
- **No conversation yet:** Show empty state in conversation area when starting fresh
- **Empty agent list:** Show message when no agents have been deployed yet

## Testing

See `product-plan/sections/agent-runtime/tests.md` for UI behavior test specs covering:
- User flow success and failure paths
- Message sending and receiving
- System prompt inspection
- Agent switching
- Empty state rendering

## Files to Reference

- `product-plan/sections/agent-runtime/README.md` — Feature overview and design intent
- `product-plan/sections/agent-runtime/tests.md` — UI behavior test specs
- `product-plan/sections/agent-runtime/types.ts` — TypeScript interfaces
- `product-plan/sections/agent-runtime/sample-data.json` — Test data with agents and conversations

## Done When

- [ ] Components render with real agent data
- [ ] Agent list displays with name, source, and timestamps
- [ ] Clicking an agent loads its conversation history
- [ ] Sending messages works and responses appear
- [ ] System prompt panel expands/collapses
- [ ] Switching between agents works correctly
- [ ] Empty states display appropriately
- [ ] Responsive on mobile

```


## product-plan/sections/agent-runtime/tests.md

```
# Test Specs: Agent Runtime

These test specs are **framework-agnostic**. Adapt them to your testing setup (Jest, Vitest, Playwright, Cypress, React Testing Library, etc.).

## Overview

The Agent Runtime is a split-pane explorer for browsing, inspecting, and testing deployed agent instances. Users can view agents, inspect their system prompts, and run test conversations.

---

## User Flow Tests

### Flow 1: Test an Agent Conversation

**Scenario:** User sends messages to an agent and receives responses

#### Success Path

**Setup:**
- Agent Runtime is loaded with available agents
- "GDPR Compliance Advisor" agent exists and is deployed
- Agent has no existing conversation (fresh state)

**Steps:**
1. User navigates to Agent Runtime
2. User sees list of agents on the left with names and sources
3. User clicks on "GDPR Compliance Advisor"
4. User sees conversation interface on the right
5. User sees "View System Prompt" button at top of detail pane
6. User types in message input: "I'm planning to collect email addresses for a newsletter. What do I need to consider for GDPR compliance?"
7. User clicks Send button (or presses Enter)
8. User message appears in conversation stream
9. After short delay, agent response appears below user message
10. **Outcome:** Conversation continues with both messages visible

**Expected Results:**
- [ ] Agent list shows agent name, source domain, and last-used timestamp
- [ ] Clicking agent highlights it as selected (violet background)
- [ ] Detail pane shows agent name and description
- [ ] Message input is at bottom, enabled and focused
- [ ] User message appears immediately after sending
- [ ] User message shows right-aligned or distinct styling
- [ ] Agent response appears with loading indicator then content
- [ ] Agent response shows left-aligned or distinct styling
- [ ] Input clears after sending, ready for next message
- [ ] Scroll position updates to show newest message

#### Failure Path: Message Send Error

**Steps:**
1. User selects an agent
2. User types and sends a message
3. Backend returns error (e.g., agent unavailable, network failure)

**Expected Results:**
- [ ] Error message appears: "Failed to send message. Please try again."
- [ ] User message remains in conversation (not lost)
- [ ] Input field retains the message text for retry
- [ ] Retry is possible

### Flow 2: View Agent's System Prompt

**Scenario:** User inspects the system prompt that defines an agent's behavior

#### Success Path

**Setup:**
- "GDPR Compliance Advisor" agent is selected
- System prompt panel is initially collapsed

**Steps:**
1. User clicks "View System Prompt" button
2. Panel expands showing the full system prompt
3. User reads the prompt content
4. User clicks "Hide System Prompt" or toggle
5. Panel collapses

**Expected Results:**
- [ ] "View System Prompt" button is visible in header
- [ ] Clicking expands a panel below header (overlay or section)
- [ ] Panel shows the full assembled system prompt text
- [ ] Prompt displays with proper formatting (line breaks, sections)
- [ ] Toggle button text changes to "Hide System Prompt"
- [ ] Collapsing hides the panel, restoring conversation view
- [ ] Conversation scroll position is preserved

### Flow 3: Switch Between Agents

**Scenario:** User switches from testing one agent to another

#### Success Path

**Setup:**
- User has active conversation with "GDPR Compliance Advisor"
- "Network Security Analyst" agent also exists

**Steps:**
1. User clicks "Network Security Analyst" in the left list
2. Detail pane updates to show the new agent
3. User sees the new agent's conversation history (if any)
4. Previous agent's conversation is no longer visible

**Expected Results:**
- [ ] Clicking different agent updates selection immediately
- [ ] New agent's name and description appear in header
- [ ] New agent's conversation history loads
- [ ] System prompt panel reflects new agent
- [ ] Message input is ready for new conversation
- [ ] Previous agent's state is preserved (not lost)

### Flow 4: Clear Conversation

**Scenario:** User wants to start a fresh conversation with an agent

#### Success Path

**Setup:**
- User has existing conversation with multiple messages

**Steps:**
1. User clicks "Clear Conversation" button
2. Confirmation dialog appears: "Clear all messages in this conversation?"
3. User clicks "Clear"
4. Conversation messages are removed
5. **Outcome:** Fresh conversation state, ready for new messages

**Expected Results:**
- [ ] "Clear Conversation" button is visible (in header or near input)
- [ ] Confirmation dialog shows warning about losing history
- [ ] After confirmation, all messages disappear
- [ ] Empty state message appears: "Start a conversation to test this agent"
- [ ] Agent selection remains the same
- [ ] System prompt is preserved

---

## Empty State Tests

### No Agent Selected Empty State

**Scenario:** No agent is currently selected

**Setup:**
- Agent Runtime is loaded
- No agent has been clicked yet

**Expected Results:**
- [ ] Detail pane shows "No agent selected" message
- [ ] Helpful text: "Select an agent from the list to test it"
- [ ] Conversation area is empty/hidden
- [ ] Message input is disabled or hidden

### No Conversation Empty State

**Scenario:** Agent is selected but has no message history

**Setup:**
- An agent is selected
- Conversation has no messages yet

**Expected Results:**
- [ ] Conversation area shows "Start a conversation" message
- [ ] Helpful text: "Type a message below to test this agent"
- [ ] Message input is enabled and focused
- [ ] System prompt can still be viewed

### Empty Agent List Empty State

**Scenario:** No agents have been deployed yet

**Setup:**
- Agent list is empty

**Expected Results:**
- [ ] Left panel shows "No agents available" message
- [ ] Helpful text: "Create agents in the Agent Builder to test them here"
- [ ] Link/button to navigate to Agent Builder

---

## Component Interaction Tests

### Agent List

**Renders correctly:**
- [ ] Shows agent name as primary label
- [ ] Shows source/domain as secondary text
- [ ] Shows "Last used" timestamp
- [ ] Selected agent has violet background
- [ ] Status indicator shows agent state (ready, starting, error)

**User interactions:**
- [ ] Clicking agent selects it
- [ ] Hover shows visual feedback
- [ ] Keyboard navigation with arrow keys
- [ ] Scrollable when many agents exist

### Conversation Panel

**Renders correctly:**
- [ ] Agent name and description in header
- [ ] Messages show in chronological order
- [ ] User messages styled differently from agent messages
- [ ] Timestamps show on messages
- [ ] Input at bottom with Send button

**User interactions:**
- [ ] Typing enables Send button
- [ ] Enter sends message, Shift+Enter adds newline
- [ ] Clicking Send sends message
- [ ] Conversation scrolls to bottom on new message
- [ ] Scroll position can be manually adjusted

### System Prompt Panel

**Renders correctly:**
- [ ] Shows assembled prompt text
- [ ] Text is formatted (line breaks, sections)
- [ ] Panel has toggle button

**User interactions:**
- [ ] Toggle expands/collapses panel
- [ ] Panel can be scrolled if content is long
- [ ] Copy button copies prompt to clipboard

---

## Edge Cases

- [ ] Handles very long agent messages (1000+ tokens)
- [ ] Handles rapid message sending (debouncing)
- [ ] Handles agent that takes long to respond (loading indicator)
- [ ] Handles agent that returns an error response
- [ ] Preserves conversation when navigating away and back
- [ ] Handles many messages in conversation (scroll performance)
- [ ] Handles very long system prompts (scroll within panel)

---

## Accessibility Checks

- [ ] All interactive elements are keyboard accessible
- [ ] Messages have proper ARIA attributes for role
- [ ] Focus management when switching agents
- [ ] Error messages are announced to screen readers
- [ ] Input has proper label and instructions

```


## product-plan/sections/agent-runtime/README.md

```
# Agent Runtime

## Overview

A split-pane explorer for browsing, inspecting, and testing deployed agent instances. Users can view agents generated from Agent Builder, inspect their assembled system prompts, and run test conversations to validate agent behavior before production use.

## User Flows

- **Browse agents** — Scan the left-pane list to see all available agents with their domain/source and timestamps
- **Inspect prompt** — Select an agent and expand the collapsible panel to view the full generated system prompt
- **Test conversation** — Select an agent, type a message in the conversation area, and receive agent responses in real-time
- **Switch contexts** — Click between agents in the list to load their detail pane and conversation history

## Design Decisions

- Split-pane layout provides context — users see the list while testing
- No inline actions in the list keeps the UI clean and focused
- Messages display in a single stream (like Claude/ChatGPT) rather than separate bubbles
- System prompt is collapsible to maximize conversation space
- Agents are read-only in this view — editing happens in Agent Builder

## Data Shapes

**Entities:**
- `Agent` — Deployed agent instance with assembled system prompt
- `AgentSource` — Reference to schema/workspace that generated the agent
- `Conversation` — Chat session with message history
- `Message` — Individual message with role (user/assistant) and content

**From global entities:** Workspace, User

## Visual Reference

See `screenshot.png` for the target UI design.

## Components Provided

- `AgentRuntime` — Main split-pane component with agent list and conversation interface

## Callback Props

| Callback | Triggered When |
|----------|---------------|
| `onSelectAgent` | User clicks an agent in the list |
| `onSendMessage` | User sends a new message |
| `onTogglePromptPanel` | User toggles system prompt panel visibility |
| `onClearConversation` | User clears the conversation history |
| `onRestartAgent` | User restarts the agent |

```


## product-plan/sections/agent-runtime/types.ts

```
/**
 * Agent Runtime Types
 *
 * Types for the Agent Runtime section, including agents, conversations,
 * and messages for testing and inspecting deployed agent instances.
 */

/**
 * Status of an agent instance
 */
export type AgentStatus = "ready" | "starting" | "stopping" | "error";

/**
 * Role of a message sender
 */
export type MessageRole = "user" | "assistant";

/**
 * Reference to the schema and configuration that generated an agent
 */
export interface AgentSource {
  /** ID of the schema used to generate this agent */
  schemaId: string;
  /** Human-readable name of the domain schema */
  schemaName: string;
  /** Workspace where the schema resides */
  workspaceName: string;
}

/**
 * A deployed agent instance with an assembled system prompt
 */
export interface Agent {
  /** Unique identifier for this agent instance */
  id: string;
  /** Display name for the agent */
  name: string;
  /** Brief description of the agent's purpose */
  description: string;
  /** Reference to the domain/schema that generated this agent */
  source: AgentSource;
  /** The full assembled system prompt used by this agent */
  systemPrompt: string;
  /** ISO timestamp when this agent was created */
  createdAt: string;
  /** ISO timestamp when this agent was last used for a conversation */
  lastUsedAt: string | null;
  /** Current status of the agent */
  status: AgentStatus;
}

/**
 * A single message in a conversation thread
 */
export interface Message {
  /** Unique identifier for this message */
  id: string;
  /** Whether the message was sent by the user or the assistant */
  role: MessageRole;
  /** The message content */
  content: string;
  /** ISO timestamp when the message was sent */
  timestamp: string;
}

/**
 * A chat session containing messages exchanged between user and agent
 */
export interface Conversation {
  /** Unique identifier for this conversation */
  id: string;
  /** ID of the agent this conversation is with */
  agentId: string;
  /** Name of the agent (for display) */
  agentName: string;
  /** Messages in this conversation, in chronological order */
  messages: Message[];
  /** ISO timestamp when the conversation was created */
  createdAt: string;
  /** ISO timestamp when the conversation was last updated */
  updatedAt: string;
}

/**
 * Props for the Agent Runtime component
 */
export interface AgentRuntimeProps {
  /** List of all available agents */
  agents: Agent[];
  /** Currently selected agent (null if none selected) */
  selectedAgentId: string | null;
  /** Active conversation for the selected agent (null if none) */
  conversation: Conversation | null;
  /** Whether the system prompt panel is expanded */
  isPromptPanelExpanded: boolean;
  /** Whether a new message is currently being sent */
  isLoading: boolean;
}

/**
 * Callback props for Agent Runtime actions
 */
export interface AgentRuntimeCallbacks {
  /** Called when an agent is selected from the list */
  onSelectAgent: (agentId: string) => void;
  /** Called when a new message is sent to the agent */
  onSendMessage: (content: string) => void;
  /** Called when the system prompt panel is toggled */
  onTogglePromptPanel: () => void;
  /** Called when a conversation is cleared */
  onClearConversation: () => void;
  /** Called when an agent is restarted */
  onRestartAgent: (agentId: string) => void;
}

```


## product-plan/sections/agent-runtime/sample-data.json

```
{
  "_meta": {
    "models": {
      "Agent": "A deployed agent instance with an assembled system prompt, ready for conversation. Each agent is generated from a domain schema and user configuration.",
      "Message": "A single message in a conversation thread, sent by either the user or the agent assistant.",
      "Conversation": "A chat session containing a thread of messages exchanged between a user and an agent.",
      "AgentSource": "Reference to the domain schema and configuration that generated this agent."
    },
    "relationships": [
      "Agent has one AgentSource (the schema + config that created it)",
      "Agent has one SystemPrompt (the assembled prompt text)",
      "Agent has many Conversations (test sessions)",
      "Conversation has many Messages (the message thread)",
      "Message has a role (user or assistant) and content"
    ]
  },
  "agents": [
    {
      "id": "agent_001",
      "name": "GDPR Compliance Advisor",
      "description": "Provides guidance on GDPR compliance for data processing activities",
      "source": {
        "schemaId": "legal-gdpr-v2",
        "schemaName": "GDPR Compliance Domain",
        "workspaceName": "Legal Ops"
      },
      "systemPrompt": "# GDPR Compliance Advisor\n\nYou are a specialized advisor for GDPR (General Data Protection Regulation) compliance. Your role is to provide guidance on data processing activities, data subject rights, and compliance requirements.\n\n## Core Principles\n- Process data lawfully, fairly, and transparently\n- Collect data for specified, explicit, and legitimate purposes\n- Ensure data is adequate, relevant, and limited to what is necessary\n- Keep data accurate and up-to-date\n- Retain data only as long as necessary\n- Process data securely\n\n## Your Capabilities\n- Assess whether a data processing activity requires a legal basis\n- Identify data subject rights that may apply\n- Suggest appropriate security measures\n- Highlight potential compliance risks\n- Recommend next steps for compliance\n\n## Limitations\nYou provide general guidance, not legal advice. For specific legal matters, direct users to consult with qualified legal counsel.\n\n## Response Style\nBe clear, structured, and practical. Use headings and bullet points when appropriate. Always highlight key compliance considerations.",
      "createdAt": "2025-01-15T09:23:00Z",
      "lastUsedAt": "2025-02-18T14:30:00Z",
      "status": "ready"
    },
    {
      "id": "agent_002",
      "name": "Network Security Analyst",
      "description": "Analyzes network traffic patterns and identifies potential security threats",
      "source": {
        "schemaId": "security-network-v1",
        "schemaName": "Network Security Domain",
        "workspaceName": "Security Team"
      },
      "systemPrompt": "# Network Security Analyst\n\nYou are a network security analyst specializing in traffic analysis, threat detection, and incident response. Analyze network patterns and provide actionable security insights.\n\n## Analysis Framework\n1. **Traffic Pattern Recognition** - Identify normal vs anomalous behavior\n2. **Threat Classification** - Categorize potential threats by type and severity\n3. **Indicator Extraction** - Pull out IOCs (Indicators of Compromise)\n4. **Recommendation** - Suggest immediate and follow-up actions\n\n## Threat Categories You Cover\n- DDoS attacks\n- Port scanning and reconnaissance\n- Malware command and control\n- Data exfiltration attempts\n- Unauthorized access attempts\n- Insider threat indicators\n\n## Output Format\nProvide analysis in structured sections:\n- **Observed**: What you see in the data\n- **Assessment**: Your interpretation of threat level\n- **Indicators**: Specific IOCs if present\n- **Actions**: Recommended containment and mitigation steps\n\nAlways estimate confidence levels for your assessments.",
      "createdAt": "2025-01-20T11:45:00Z",
      "lastUsedAt": "2025-02-19T08:15:00Z",
      "status": "ready"
    },
    {
      "id": "agent_003",
      "name": "Cloud Cost Optimizer",
      "description": "Recommends cost optimizations for cloud infrastructure spending",
      "source": {
        "schemaId": "cloud-cost-v3",
        "schemaName": "Cloud Cost Management",
        "workspaceName": "FinOps"
      },
      "systemPrompt": "# Cloud Cost Optimizer\n\nYou help organizations optimize their cloud infrastructure costs across AWS, Azure, and GCP. Analyze spending patterns and recommend practical cost-saving measures.\n\n## Analysis Areas\n- Compute instance rightsizing\n- Storage tier optimization\n- Network transfer costs\n- Unused resource identification\n- Reserved instance opportunities\n- Spot instance applicability\n- Multi-region cost considerations\n\n## Optimization Principles\n1. Prioritize actions by effort vs. impact\n2. Consider performance implications\n3. Factor in engineering effort required\n4. Highlight quick wins first\n5. Note any trade-offs clearly\n\n## Response Format\nFor each recommendation, provide:\n- **Category**: What type of resource\n- **Current State**: What's happening now\n- **Recommendation**: What to change\n-- **Estimated Savings**: Potential monthly/annual savings\n- **Effort**: Low/Medium/High implementation effort\n\nBe specific but acknowledge when you need more data for precise recommendations.",
      "createdAt": "2025-02-01T16:00:00Z",
      "lastUsedAt": "2025-02-18T16:00:00Z",
      "status": "ready"
    },
    {
      "id": "agent_004",
      "name": "API Documentation Assistant",
      "description": "Generates and maintains API documentation from OpenAPI specs",
      "source": {
        "schemaId": "docs-api-v1",
        "schemaName": "API Documentation",
        "workspaceName": "Developer Experience"
      },
      "systemPrompt": "# API Documentation Assistant\n\nYou generate clear, comprehensive API documentation from OpenAPI/Swagger specifications. Your goal is to create developer-friendly documentation that helps API consumers integrate quickly and correctly.\n\n## Documentation Sections\nFor each endpoint, document:\n1. **Purpose** - What the endpoint does and when to use it\n2. **Request** - Method, path, parameters, headers, body schema\n3. **Response** - Status codes, response schema, examples\n4. **Errors** - Common error scenarios and resolutions\n5. **Examples** - Realistic request/response examples in multiple languages\n\n## Style Guidelines\n- Use present tense (\"Returns\", \"Creates\", not \"Will return\")\n- Be concise but complete\n- Include at least one code example per endpoint\n- Highlight required vs optional parameters clearly\n- Note any authentication requirements prominently\n- Document rate limits if applicable\n\n## Example Languages\nProvide examples in:\n- cURL\n- Python (requests)\n- JavaScript (fetch)\n- At least one major framework-specific library if relevant",
      "createdAt": "2025-02-05T10:30:00Z",
      "lastUsedAt": "2025-02-17T09:45:00Z",
      "status": "ready"
    },
    {
      "id": "agent_005",
      "name": "Customer Support Triage",
      "description": "Classifies and routes incoming customer support requests",
      "source": {
        "schemaId": "support-triage-v2",
        "schemaName": "Customer Support Triage",
        "workspaceName": "Customer Success"
      },
      "systemPrompt": "# Customer Support Triage Agent\n\nYou classify and route incoming customer support requests to the appropriate team. Your job is to understand the issue, assess urgency, and determine the best resolution path.\n\n## Classification Categories\n- **Billing**: Invoices, payments, subscriptions, refunds\n- **Technical**: Bugs, errors, performance issues, integrations\n- **Account**: Access, permissions, profile changes, SSO\n- **Feature Request**: New capabilities, enhancements, product feedback\n- **Knowledge**: How-to questions, best practices, documentation needs\n\n## Urgency Levels\n- **Critical**: System down, data loss, security incident, revenue impact\n- **High**: Major feature blocked, multiple users affected\n- **Medium**: Single user blocked, workaround exists\n- **Low**: Nice-to-have, question, non-blocking\n\n## Output Format\nFor each ticket, provide:\n```\nCategory: [category]\nUrgency: [urgency level]\nSummary: [one-line summary]\nSuggested Team: [team name]\nKey Details: [bullet points of important info]\nNext Steps: [what should happen next]\n```",
      "createdAt": "2025-02-08T14:15:00Z",
      "lastUsedAt": "2025-02-19T10:20:00Z",
      "status": "ready"
    },
    {
      "id": "agent_006",
      "name": "Data Quality Validator",
      "description": "Validates data quality issues and suggests remediation steps",
      "source": {
        "schemaId": "data-quality-v1",
        "schemaName": "Data Quality Management",
        "workspaceName": "Data Platform"
      },
      "systemPrompt": "# Data Quality Validator\n\nYou identify data quality issues and provide remediation guidance. Analyze data patterns and recommend specific fixes for common quality problems.\n\n## Quality Dimensions You Check\n- **Completeness**: Missing values, null handling, sparse data\n- **Accuracy**: Value validity, format correctness, outliers\n- **Consistency**: Cross-field validation, format standardization\n- **Timeliness**: Stale data, currency issues\n- **Uniqueness**: Duplicates, near-duplicates, primary key violations\n- **Validity**: Schema compliance, data type issues, constraint violations\n\n## Analysis Output\nFor each issue found:\n- **Issue**: What type of quality problem\n- **Location**: Where it occurs (table/column/row)\n- **Impact**: How this affects downstream systems or analytics\n- **Remediation**: Specific SQL or code to fix the issue\n- **Prevention**: How to prevent this going forward\n\n## Best Practices\n- Quantify the extent of issues when possible (e.g., \"23% of rows\")\n- Prioritize issues by business impact\n- Suggest both quick fixes and structural solutions\n- Consider trade-offs between strictness and flexibility",
      "createdAt": "2025-02-10T08:00:00Z",
      "lastUsedAt": null,
      "status": "ready"
    },
    {
      "id": "agent_007",
      "name": "Incident Response Coordinator",
      "description": "Guides teams through incident response procedures during outages",
      "source": {
        "schemaId": "incident-response-v1",
        "schemaName": "Incident Management",
        "workspaceName": "SRE"
      },
      "systemPrompt": "# Incident Response Coordinator\n\nYou guide teams through structured incident response during service outages or degradations. Follow best practices from incident management frameworks.\n\n## Response Workflow\n\n### 1. Assessment (First 5 minutes)\n- Gather initial symptoms and scope\n- Determine severity level (SEV1-4)\n- Identify affected services and customers\n- Establish communication channels\n\n### 2. Triage\n- Identify potential root causes\n- Determine which teams need to be involved\n- Check recent changes (deployments, config updates)\n- Review monitoring and logs\n\n### 3. Mitigation\n- Implement temporary fixes to restore service\n- Document what was done and why\n- Verify the fix is working\n- Communicate status to stakeholders\n\n### 4. Resolution\n- Implement permanent fix\n- Update runbooks for future incidents\n- Conduct postmortem\n- Track action items\n\n## Communication Style\n- Be calm and directive\n- Use clear, unambiguous language\n- Specify who should do what\n- Highlight time-sensitive actions\n- Note when to escalate\n\n## Severity Definitions\n- **SEV1**: Critical service down, major customer impact\n- **SEV2**: Significant degradation, partial outage\n- **SEV3**: Minor issues, workaround available\n- **SEV4**: Low impact, cosmetic or documentation",
      "createdAt": "2025-02-12T13:20:00Z",
      "lastUsedAt": "2025-02-18T11:00:00Z",
      "status": "ready"
    },
    {
      "id": "agent_008",
      "name": "ML Model Debugger",
      "description": "Helps diagnose and fix machine learning model performance issues",
      "source": {
        "schemaId": "ml-debugging-v1",
        "schemaName": "ML Debugging & Diagnostics",
        "workspaceName": "ML Platform"
      },
      "systemPrompt": "# ML Model Debugger\n\nYou help diagnose machine learning model performance issues. Analyze model metrics, data patterns, and training configurations to identify problems and suggest solutions.\n\n## Diagnostic Categories\n\n### Data Issues\n- Data distribution shift\n- Label noise or leakage\n- Insufficient or imbalanced samples\n- Feature engineering problems\n- Preprocessing bugs\n\n### Training Issues\n- Overfitting/underfitting\n- Learning rate problems\n- Optimization convergence issues\n- Batch size effects\n- Regularization tuning\n\n### Model Issues\n- Architecture mismatch for problem\n- Capacity problems\n- Gradient flow issues\n- Hyperparameter choices\n\n## Diagnostic Process\n1. **Understand the Problem**: What's the expected vs actual behavior?\n2. **Review Metrics**: Training/validation/test performance, loss curves\n3. **Examine Data**: Samples, distributions, splits\n4. **Check Configuration**: Hyperparameters, architecture, training setup\n5. **Isolate Variables**: What changed? What's different?\n\n## Response Format\nProvide:\n- **Hypothesis**: What you think is wrong\n- **Evidence**: What supports this hypothesis\n- **Tests**: How to confirm the diagnosis\n- **Solutions**: Specific fixes to try, ordered by likelihood\n- **Prevention**: How to avoid similar issues",
      "createdAt": "2025-02-14T15:45:00Z",
      "lastUsedAt": "2025-02-19T07:30:00Z",
      "status": "ready"
    }
  ],
  "conversations": [
    {
      "id": "conv_001",
      "agentId": "agent_001",
      "agentName": "GDPR Compliance Advisor",
      "messages": [
        {
          "id": "msg_001_1",
          "role": "user",
          "content": "I'm planning to collect email addresses for a newsletter. What do I need to consider for GDPR compliance?",
          "timestamp": "2025-02-18T14:30:00Z"
        },
        {
          "id": "msg_001_2",
          "role": "assistant",
          "content": "For newsletter email collection under GDPR, here are the key considerations:\n\n## Legal Basis\nYou need a valid legal basis. For marketing emails, **consent** is typically required. Consent must be:\n- Freely given and specific\n- Informed through clear disclosure\n- Unambiguous (not pre-checked boxes)\n- Easily withdrawable\n\n## Information to Provide\nAt collection time, tell subscribers:\n- Who you are (your organization)\n- What you'll do with their email\n- How to unsubscribe\n- How long you'll retain their data\n\n## Practical Requirements\n- **Double opt-in** is recommended for demonstrable consent\n- Include an **unsubscribe link** in every email\n- Honor unsubscribe requests **without delay**\n- Maintain a **consent log** documenting when and how they opted in\n- Keep a **suppression list** of unsubscribed addresses\n\n## Rights to Respect\n- Right to access their data\n- Right to rectification\n- Right to erasure (\"right to be forgotten\")\n- Right to object to processing\n\nWould you like me to elaborate on any of these points?",
          "timestamp": "2025-02-18T14:30:15Z"
        },
        {
          "id": "msg_001_3",
          "role": "user",
          "content": "How long should I keep the consent records?",
          "timestamp": "2025-02-18T14:31:00Z"
        },
        {
          "id": "msg_001_4",
          "role": "assistant",
          "content": "There's no single GDPR-defined period, but here's practical guidance:\n\n## Retention Considerations\n\n**While the person is subscribed**: Keep the consent record for the duration of their subscription plus a reasonable period after.\n\n**After unsubscription**: Keep consent records for **defence against legal claims** — typically 2-3 years is considered reasonable, but consult your legal team as this varies by jurisdiction and industry.\n\n**Data minimization principle**: Don't keep records longer than necessary. Consider:\n- Your legal obligation periods\n- Statute of limitations for relevant claims\n- Industry-specific requirements\n\n## Recommended Practice\n- Document your retention policy\n- Implement automatic deletion policies\n- For newsletters specifically: retain consent for 2-3 years after unsubscription or cancellation\n\nNote: This is general guidance. Specific retention periods may be affected by local laws and your organization's risk profile.",
          "timestamp": "2025-02-18T14:31:20Z"
        }
      ],
      "createdAt": "2025-02-18T14:30:00Z",
      "updatedAt": "2025-02-18T14:31:20Z"
    },
    {
      "id": "conv_002",
      "agentId": "agent_001",
      "agentName": "GDPR Compliance Advisor",
      "messages": [
        {
          "id": "msg_002_1",
          "role": "user",
          "content": "Can I transfer user data to the United States?",
          "timestamp": "2025-02-17T10:15:00Z"
        },
        {
          "id": "msg_002_2",
          "role": "assistant",
          "content": "Transferring personal data to the US requires additional safeguards due to differences in privacy laws.\n\n## Legal Framework\nFollowing the Schrems II decision, the standard mechanisms are:\n\n1. ** adequacy decision** - The US does not have an adequacy decision from the EU\n\n2. **Standard Contractual Clauses (SCCs)** - Approved by the European Commission, but must be supplemented with:\n   - Transfer Impact Assessment (TIA)\n   - Additional technical safeguards where needed\n\n3. **Binding Corporate Rules (BCR)** - For internal transfers within corporate groups\n\n## Transfer Impact Assessment\nYou must assess whether the destination country's laws undermine the protections SCCs provide. For the US, consider:\n- US surveillance programs access\n- Data subject's ability to seek redress\n- Encryption status of the data\n\n## Practical Steps\n1. Execute SCCs with the US recipient\n2. Conduct a TIA documenting the assessment\n3. Implement supplementary measures (e.g., encryption)\n4. Document the entire process\n\nThis is a complex area — I strongly recommend consulting with legal counsel for your specific situation.",
          "timestamp": "2025-02-17T10:15:30Z"
        }
      ],
      "createdAt": "2025-02-17T10:15:00Z",
      "updatedAt": "2025-02-17T10:15:30Z"
    },
    {
      "id": "conv_003",
      "agentId": "agent_002",
      "agentName": "Network Security Analyst",
      "messages": [
        {
          "id": "msg_003_1",
          "role": "user",
          "content": "I'm seeing 500 failed login attempts from the same IP in the last 10 minutes. Is this an attack?",
          "timestamp": "2025-02-19T08:15:00Z"
        },
        {
          "id": "msg_003_2",
          "role": "assistant",
          "content": "## Assessment\n\n**Observed**: 500 failed login attempts from a single source IP within 10 minutes\n\n**Assessment**: HIGH CONFIDENCE — This is a credential stuffing or brute force attack\n\n**Threat Classification**: Credential Stuffing / Brute Force Attack\n\n## Analysis\n500 attempts in 10 minutes equals ~50 attempts per minute or roughly 1 attempt per second. This pattern is:\n- **Automated**: No human could manually attempt logins this fast\n- **Targeted**: Specifically focused on authentication endpoints\n- **Persistent**: Sustained rate indicates a determined attacker\n\n## Recommended Actions\n\n**Immediate (do now)**:\n1. Block the source IP at the firewall/WAF\n2. Enable rate limiting on auth endpoints (e.g., 5 attempts per minute)\n3. Trigger alerts for similar patterns from other IPs\n\n**Short-term (today)**:\n4. Check if any logins succeeded from this IP\n5. Review user accounts for suspicious activity\n6. Consider enabling CAPTCHA for failed login attempts\n\n**Longer-term**:\n7. Implement account lockout after N failed attempts\n8. Deploy MFA if not already in place\n9. Add this IP to threat intelligence feeds\n\n## Indicators\n- IOC: Source IP (provide the IP for blocklisting)\n- Pattern: High-frequency auth failures\n\nWould you like help setting up any of these mitigations?",
          "timestamp": "2025-02-19T08:15:25Z"
        }
      ],
      "createdAt": "2025-02-19T08:15:00Z",
      "updatedAt": "2025-02-19T08:15:25Z"
    },
    {
      "id": "conv_004",
      "agentId": "agent_002",
      "agentName": "Network Security Analyst",
      "messages": [
        {
          "id": "msg_004_1",
          "role": "user",
          "content": "What does it mean if I see traffic on port 4444 from multiple internal servers?",
          "timestamp": "2025-02-18T16:45:00Z"
        },
        {
          "id": "msg_004_2",
          "role": "assistant",
          "content": "## Assessment\nPort 4444 is commonly associated with:\n- **Metasploit Framework** — default listening port for reverse shells\n- **Some monitoring tools** — certain agents use this port\n- **Custom services** — sometimes used for internal applications\n\n**Multiple internal servers** communicating on 4444 is concerning and warrants investigation.\n\n## Investigation Steps\n\n1. **Identify the processes**\n   ```bash\n   netstat -tulpn | grep 4444\n   lsof -i :4444\n   ```\n\n2. **Check for known legitimate uses**\n   - Is this a known monitoring agent (e.g., NRPE, custom monitoring)?\n   - Is there a scheduled task or cron job?\n\n3. **Examine traffic patterns**\n   - Is the traffic persistent or intermittent?\n   - Are the connections outbound to external IPs?\n   - What's the data volume (beaconing vs data transfer)?\n\n## Red Flags (If present, investigate urgently)\n- ✗ Process names you don't recognize\n- ✗ Connections to external/internet IPs\n- ✗ Encrypted traffic with no legitimate explanation\n- ✗ Recent software installs or changes on affected servers\n- ✗ Coincides with other security alerts\n\n## Assessment Confidence\nWithout more details, I cannot definitively classify this. **Priority: Investigate within 1 hour.**\n\nCan you share the process names or destination IPs?",
          "timestamp": "2025-02-18T16:45:30Z"
        }
      ],
      "createdAt": "2025-02-18T16:45:00Z",
      "updatedAt": "2025-02-18T16:45:30Z"
    },
    {
      "id": "conv_005",
      "agentId": "agent_003",
      "agentName": "Cloud Cost Optimizer",
      "messages": [
        {
          "id": "msg_005_1",
          "role": "user",
          "content": "My AWS bill for EC2 is $15,000/month. What should I look at first?",
          "timestamp": "2025-02-18T16:00:00Z"
        },
        {
          "id": "msg_005_2",
          "role": "assistant",
          "content": "For a $15K/month EC2 bill, here's your priority order for optimization:\n\n## Quick Wins (Start Here)\n\n**1. Identify Idle Instances**\n- Check for instances with low CPU utilization (<5%)\n- Look for test/dev instances left running\n- **Potential savings**: 10-30% with minimal effort\n\n**2. Review Instance Types**\n- Check if instances are oversized for their workload\n- Compare EC2 instance rightsizing recommendations\n- **Potential savings**: 15-40% on affected instances\n\n**3. Check for Untagged Resources**\n- Resources without tags often belong to orphaned projects\n- Untagged resources also indicate governance issues\n\n## Medium Effort, High Impact\n\n**4. Reserved Instances (RIs) or Savings Plans**\n- For steady-state workloads (24/7 services)\n- **Potential savings**: 30-50% on covered instances\n- Commitment: 1-3 years\n\n**5. Spot Instances**\n- For fault-tolerant, interruptible workloads\n- Batch jobs, CI/CD workers, async processing\n- **Potential savings**: 50-90% vs on-demand\n\n## Next Steps\n1. Download your Cost and Usage Report (CUR)\n2. Check AWS Trusted Advisor for compute optimization\n3. Enable AWS Compute Optimizer recommendations\n\nWhat type of workload do you run on these instances? That will help me be more specific.",
          "timestamp": "2025-02-18T16:00:30Z"
        },
        {
          "id": "msg_005_3",
          "role": "user",
          "content": "Mostly web servers and a few database servers. The web servers handle traffic during business hours mostly.",
          "timestamp": "2025-02-18T16:02:00Z"
        },
        {
          "id": "msg_005_4",
          "role": "assistant",
          "content": "That pattern gives you some great optimization opportunities:\n\n## Web Servers (Business Hours = Predictable)\n\n**1. Auto-scaling with Schedule**\n- Scale down during non-business hours\n- **Estimated savings**: 40-60% on compute during off hours\n- **Effort**: Low\n\n**2. Use Savings Plans for baseline**\n- Commit to the minimum capacity you need 24/7\n- Auto-scale above that baseline during peak hours\n- **Estimated savings**: 30-40% on baseline capacity\n- **Effort**: Low-Medium\n\n**3. Consider Graviton (ARM) Instances**\n- If you're on x86, ARM instances cost ~20% less\n- Web servers often have good ARM compatibility\n- **Estimated savings**: 15-20%\n- **Effort**: Medium (testing required)\n\n## Database Servers\n\nDatabases need more careful handling:\n- **Don't auto-scale down aggressively** — restarts are painful\n- **Reserved Instances recommended** for steady-state DBs\n- **Check instance types** — databases are often over-provisioned\n\n## Recommended Action Plan\n1. **Week 1**: Enable auto-scaling with schedule for web servers\n2. **Week 2**: Purchase Savings Plans for baseline capacity\n3. **Week 3**: Test one web server tier on Graviton instances\n4. **Week 4**: Rightsizing analysis for database servers\n\nWould you like me to walk through setting up the auto-scaling schedule?",
          "timestamp": "2025-02-18T16:02:45Z"
        }
      ],
      "createdAt": "2025-02-18T16:00:00Z",
      "updatedAt": "2025-02-18T16:02:45Z"
    },
    {
      "id": "conv_006",
      "agentId": "agent_005",
      "agentName": "Customer Support Triage",
      "messages": [
        {
          "id": "msg_006_1",
          "role": "user",
          "content": "I need to classify this ticket: 'Our API integration is returning 500 errors for the past hour. This is blocking our entire order processing pipeline.'",
          "timestamp": "2025-02-19T10:20:00Z"
        },
        {
          "id": "msg_006_2",
          "role": "assistant",
          "content": "## Triage Classification\n\n**Category**: Technical\n\n**Urgency**: Critical\n\n**Summary**: Production API 500 errors blocking order processing\n\n**Suggested Team**: API / Backend Engineering (On-Call)\n\n**Key Details**:\n- Impact: Order processing pipeline blocked (business-critical)\n- Duration: Past hour (ongoing incident)\n- Error: HTTP 500 (server-side error)\n- Scope: Affects API integrations\n\n**Next Steps**:\n1. **Immediately**: Page the on-call engineer\n2. Check status page for known incidents\n3. Verify if this affects all customers or specific accounts\n4. Check recent deployments for potential regression\n5. Update ticket with incident ID once created\n\nThis warrants immediate escalation due to business impact.",
          "timestamp": "2025-02-19T10:20:10Z"
        }
      ],
      "createdAt": "2025-02-19T10:20:00Z",
      "updatedAt": "2025-02-19T10:20:10Z"
    },
    {
      "id": "conv_007",
      "agentId": "agent_007",
      "agentName": "Incident Response Coordinator",
      "messages": [
        {
          "id": "msg_007_1",
          "role": "user",
          "content": "We're seeing high error rates on our payment service. Payments are failing about 60% of the time. This started 10 minutes ago.",
          "timestamp": "2025-02-18T11:00:00Z"
        },
        {
          "id": "msg_007_2",
          "role": "assistant",
          "content": "## Incident Declaration: SEV1\n\nA payment service with 60% failure rate affecting revenue is a **SEV1 incident**.\n\n### Immediate Actions (Next 5 Minutes)\n\n**1. Establish Command**\n- Who is leading this incident?\n- Create incident channel (e.g., #incident-payments-YYYY-MM-DD)\n- Identify technical lead and communications lead\n\n**2. Assess Scope**\n- [ ] Is this affecting all payment methods or specific ones?\n- [ ] Are all customers affected or a subset?\n- [ ] What's the financial impact per minute?\n- [ ] Can payments be queued for retry later?\n\n**3. Recent Changes**\n- [ ] Any deployments in the last 30 minutes?\n- [ ] Any config changes?\n- [ ] Third-party payment provider status?\n\n**4. Initial Mitigation**\n- [ ] Check payment provider status page\n- [ ] Roll back recent deployment if applicable\n- [ ] Enable maintenance mode if appropriate\n- [ ] Route to backup payment gateway if available\n\n### Communication\n- Notify: Engineering leadership, Customer Support, Product\n- Update status page if customer-facing\n\nPlease confirm: Are you the incident lead, and who else needs to be paged?",
          "timestamp": "2025-02-18T11:00:30Z"
        },
        {
          "id": "msg_007_3",
          "role": "user",
          "content": "I'm the incident lead. We did deploy a change to the payment service 20 minutes ago. Should we roll back?",
          "timestamp": "2025-02-18T11:05:00Z"
        },
        {
          "id": "msg_007_4",
          "role": "assistant",
          "content": "## Rollback Recommendation: YES\n\nWith the timing correlation (deployment 20 min ago → failures started 10 min ago), a rollback is the right call.\n\n### Rollback Execution\n\n**1. Pre-Rollback Check**\n- [ ] Confirm the previous stable version (commit SHA or release tag)\n- [ ] Ensure rollback procedure is documented\n- [ ] Alert team that a rollback is imminent\n\n**2. Execute Rollback**\n- [ ] Initiate rollback to last known good version\n- [ ] Monitor deployment progress\n- [ ] Watch error rates during rollback\n\n**3. Post-Rollback Verification**\n- [ ] Check error rates drop below baseline\n- [ ] Verify test payment succeeds\n- [ ] Confirm no new errors introduced\n\n**4. If Rollback Fails or Issues Persist**\n- Escalate to database/network/security teams\n- Consider enabling maintenance mode\n- Continue investigation with full team\n\n### After Rollback\nOnce stable, create a postmortem ticket to:\n- Analyze what went wrong with the deployment\n- Improve pre-deployment testing\n- Consider slower rollout strategies (canary, blue-green)\n\nExecuting rollback now. Confirm when complete.",
          "timestamp": "2025-02-18T11:05:30Z"
        }
      ],
      "createdAt": "2025-02-18T11:00:00Z",
      "updatedAt": "2025-02-18T11:05:30Z"
    },
    {
      "id": "conv_008",
      "agentId": "agent_008",
      "agentName": "ML Model Debugger",
      "messages": [
        {
          "id": "msg_008_1",
          "role": "user",
          "content": "My classification model has 95% training accuracy but only 72% test accuracy. What's happening?",
          "timestamp": "2025-02-19T07:30:00Z"
        },
        {
          "id": "msg_008_2",
          "role": "assistant",
          "content": "## Diagnosis: Overfitting\n\nThe 23% gap between training and test accuracy is a classic sign of **overfitting** — your model is memorizing the training data rather than learning generalizable patterns.\n\n### Evidence Supporting This Diagnosis\n- High training accuracy (95%) suggests model has capacity to learn\n- Lower test accuracy (72%) shows poor generalization\n- The gap (>20%) is too large to be random variance\n\n### Common Causes\n\n1. **Model too complex** — Too many parameters relative to training data\n2. **Insufficient training data** — Not enough examples to learn from\n3. **Data leakage** — Test information leaked into training (check this!)\n4. **Excessive training** — Trained for too many epochs\n5. **Feature noise** — Too many features, some irrelevant\n\n### Tests to Confirm\n\n**1. Learning Curve Analysis**\n```\nPlot training vs validation accuracy over epochs:\n- If validation degrades while training improves → overfitting\n- If both plateau with gap → model capacity issue\n```\n\n**2. Check Data Leakage**\n- Are any features directly correlated with the target?\n- Do train/test sets have overlapping samples?\n- Is there temporal leakage (future data in training)?\n\n**3. Model Complexity Check**\n- Compare training set size to parameter count\n- Rule of thumb: 10x more samples than parameters\n\n### Solutions (Ordered by Likelihood)\n\n**1. Reduce Model Complexity**\n- Fewer layers or fewer neurons per layer\n- **Effort**: Low | **Impact**: High\n\n**2. Add Regularization**\n- L1/L2 regularization, dropout\n- **Effort**: Low | **Impact**: High\n\n**3. Early Stopping**\n- Stop when validation performance plateaus\n- **Effort**: Low | **Impact**: Medium\n\n**4. Increase Training Data**\n- Gather more samples or use data augmentation\n- **Effort**: High | **Impact**: High\n\n**5. Feature Selection**\n- Remove irrelevant features, use dimensionality reduction\n- **Effort**: Medium | **Impact**: Medium\n\n### Recommended First Step\nPlot your learning curves. This will confirm overfitting and show if the problem emerged during training or was present from the start.\n\nCan you share:\n- Training set size\n- Model architecture (layers, parameters)\n- Any regularization you're already using?",
          "timestamp": "2025-02-19T07:30:45Z"
        }
      ],
      "createdAt": "2025-02-19T07:30:00Z",
      "updatedAt": "2025-02-19T07:30:45Z"
    },
    {
      "id": "conv_009",
      "agentId": "agent_004",
      "agentName": "API Documentation Assistant",
      "messages": [
        {
          "id": "msg_009_1",
          "role": "user",
          "content": "Generate documentation for this endpoint: POST /users/create with firstName, lastName, email (required), and phone (optional) fields. Returns 201 with user ID or 400 for validation errors.",
          "timestamp": "2025-02-17T09:45:00Z"
        },
        {
          "id": "msg_009_2",
          "role": "assistant",
          "content": "# POST /users/create\n\nCreates a new user account in the system.\n\n## Request\n\n**Method**: `POST`\n\n**Path**: `/users/create`\n\n**Headers**:\n```\nContent-Type: application/json\nAuthorization: Bearer {token}\n```\n\n**Body Parameters**:\n\n| Field | Type | Required | Description |\n|-------|------|----------|-------------|\n| firstName | string | No | User's first name |\n| lastName | string | No | User's last name |\n| email | string | **Yes** | User's email address (must be valid format, unique) |\n| phone | string | No | User's phone number |\n\n## Response\n\n**Success** (201 Created)\n\nReturns the created user's ID.\n\n```json\n{\n  \"id\": \"usr_123abc456\",\n  \"email\": \"user@example.com\"\n}\n```\n\n**Error** (400 Bad Request)\n\nReturned when validation fails.\n\n```json\n{\n  \"error\": \"Validation failed\",\n  \"fields\": [\n    {\"field\": \"email\", \"message\": \"Email is required\"},\n    {\"field\": \"email\", \"message\": \"Email already exists\"}\n  ]\n}\n```\n\n## Examples\n\n**cURL**:\n```bash\ncurl -X POST https://api.example.com/users/create \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Authorization: Bearer YOUR_TOKEN\" \\\n  -d '{\n    \"firstName\": \"Jane\",\n    \"lastName\": \"Doe\",\n    \"email\": \"jane.doe@example.com\",\n    \"phone\": \"+1-555-0123\"\n  }'\n```\n\n**Python (requests)**:\n```python\nimport requests\n\nresponse = requests.post(\n    'https://api.example.com/users/create',\n    headers={'Authorization': 'Bearer YOUR_TOKEN'},\n    json={\n        'firstName': 'Jane',\n        'lastName': 'Doe',\n        'email': 'jane.doe@example.com',\n        'phone': '+1-555-0123'\n    }\n)\nprint(response.json())\n```\n\n**JavaScript (fetch)**:\n```javascript\nconst response = await fetch('https://api.example.com/users/create', {\n  method: 'POST',\n  headers: {\n    'Content-Type': 'application/json',\n    'Authorization': 'Bearer YOUR_TOKEN'\n  },\n  body: JSON.stringify({\n    firstName: 'Jane',\n    lastName: 'Doe',\n    email: 'jane.doe@example.com',\n    phone: '+1-555-0123'\n  })\n});\nconst data = await response.json();\nconsole.log(data);\n```\n\n## Notes\n- Email addresses must be unique across all users\n- Phone numbers should be in E.164 format if possible\n- Only `email` is required, but including names is recommended",
          "timestamp": "2025-02-17T09:45:30Z"
        }
      ],
      "createdAt": "2025-02-17T09:45:00Z",
      "updatedAt": "2025-02-17T09:45:30Z"
    },
    {
      "id": "conv_010",
      "agentId": "agent_006",
      "agentName": "Data Quality Validator",
      "messages": [
        {
          "id": "msg_010_1",
          "role": "user",
          "content": "I'm seeing NULL values in 40% of rows for the 'customer_since' column in our users table. Is this a problem?",
          "timestamp": "2025-02-15T13:20:00Z"
        },
        {
          "id": "msg_010_2",
          "role": "assistant",
          "content": "## Issue: Incomplete Data (Missing Values)\n\n**Dimension**: Completeness\n\n**Location**: `users.customer_since` column\n\n### Assessment\n40% missing values in a date field is significant. Whether it's a problem depends on the business context.\n\n### Potential Impacts\n\n**Downstream Analytics**:\n- Customer lifetime calculations will be incorrect or incomplete\n- Cohort analysis will exclude or misclassify 40% of users\n- Churn models may be skewed if this is a feature\n\n**Business Operations**:\n- Loyalty program eligibility may be misapplied\n- Anniversary marketing campaigns will miss these users\n\n### Investigation Questions\n\n1. **Why are these NULL?**\n   - Legacy data from before the column existed?\n   - Data migration issue?\n   - Registration flow bug?\n   - Intentionally left blank?\n\n2. **Is there a pattern?**\n   ```sql\n   -- Check if NULLs correlate with other factors\n   SELECT \n     source,     \n     COUNT(*) as total,\n     SUM(CASE WHEN customer_since IS NULL THEN 1 ELSE 0 END) as null_count,\n     SUM(CASE WHEN customer_since IS NULL THEN 1 ELSE 0 END) * 100.0 / COUNT(*) as pct_null\n   FROM users\n   GROUP BY source;\n   ```\n\n### Remediation Options\n\n**Option 1: Backfill from Historical Data**\n```sql\n-- If you have a created_at timestamp, use it\nUPDATE users \nSET customer_since = created_at \nWHERE customer_since IS NULL AND created_at IS NOT NULL;\n```\n- **Effort**: Low\n- **Impact**: High\n\n**Option 2: Infer from Related Data**\n```sql\n-- Use first order date as proxy\nUPDATE users u\nSET customer_since = (\n  SELECT MIN(order_date)\n  FROM orders o\n  WHERE o.user_id = u.id\n)\nWHERE customer_since IS NULL;\n```\n\n**Option 3: Set Default Value**\n```sql\n-- If appropriate, set to account creation or a known date\nUPDATE users\nSET customer_since = '2000-01-01'  -- or business-specific default\nWHERE customer_since IS NULL;\n```\n\n**Option 4: Accept NULLs**\n- Document that the field can be NULL\n- Update BI/analytics to handle NULL properly\n- Fix registration flow to require the value going forward\n\n### Prevention\n```sql\n-- Add constraint to prevent future NULLs\nALTER TABLE users\nMODIFY COLUMN customer_since DATE NOT NULL;\n\n-- Add default for new registrations\nALTER TABLE users\nMODIFY COLUMN customer_since DATE DEFAULT (CURRENT_DATE);\n```\n\n### Recommended Action\n1. First, determine *why* these are NULL (use the investigation query above)\n2. If it's a registration bug: fix and backfill from `created_at`\n3. If it's legacy data: backfill from the earliest reliable date\n4. Add NOT NULL constraint after remediation\n\nWhat's the registration flow for this field — is it collected or derived?",
          "timestamp": "2025-02-15T13:21:00Z"
        }
      ],
      "createdAt": "2025-02-15T13:20:00Z",
      "updatedAt": "2025-02-15T13:21:00Z"
    },
    {
      "id": "conv_011",
      "agentId": "agent_005",
      "agentName": "Customer Support Triage",
      "messages": [],
      "createdAt": "2025-02-19T12:00:00Z",
      "updatedAt": "2025-02-19T12:00:00Z"
    }
  ]
}

```


## product-plan/instructions/incremental/05-workspaces.md

```
# Milestone 5: Workspaces

> **Provide alongside:** `product-plan/product-overview.md`
> **Prerequisites:** Milestone 1 (Shell) complete

---

## About This Handoff

**What you're receiving:**
- Finished UI designs (React components with full styling)
- Product requirements and user flow specifications
- Design system tokens (colors, typography)
- Sample data showing the shape of data components expect
- Test specs focused on user-facing behavior

**Your job:**
- Integrate these components into your application
- Wire up callback props to your routing and business logic
- Replace sample data with real data from your backend
- Implement loading, error, and empty states

The components are props-based — they accept data and fire callbacks. How you architect the backend, data layer, and business logic is up to you.

---

## Goal

Implement the Workspaces feature — a user and permission management interface for administrators to manage workspace members with role-based access control.

## Overview

The Workspaces section provides a two-panel layout with a user list sidebar on the left and a detail panel on the right. Administrators can view all workspace users, see their status and role, and modify permissions. The interface supports three roles (Admin, Editor, Viewer) and three statuses (active, invited, pending). This is where collaboration and access control are managed for the platform.

**Key Functionality:**
- View all users in the workspace via the sidebar list with avatars and status indicators
- Click a user to view their profile, status, and role in the main detail panel
- Edit a user's role (Admin, Editor, or Viewer) from the detail panel
- Add a new user by entering their email and assigning an initial role
- Remove a user from the workspace with confirmation
- Filter or search for users by name or email
- See visual status badges for user state (active, invited, pending)

## Components Provided

Copy the section components from `product-plan/sections/workspaces/components/`:

- `Workspaces.tsx` — Main component with user list sidebar and detail panel
- `WorkspaceList.tsx` — Sidebar listing all workspace users
- `UserDetailPanel.tsx` — Detail panel showing selected user's profile and role editor

## Props Reference

The components expect these data shapes (see `types.ts` for full definitions):

**Data props:**

- `users: WorkspaceUser[]` — All users in the current workspace
- `roles: RoleDefinition[]` — Available role definitions (Admin, Editor, Viewer)
- `selectedUserId?: string | null` — Currently selected user for detail view
- `searchQuery?: string` — Current search/filter query

**Callback props:**

| Callback | Triggered When |
|----------|---------------|
| `onSelectUser` | User clicks a user in the sidebar |
| `onSearchChange` | User types in search input |
| `onUpdateRole` | User changes a user's role |
| `onInviteUser` | User invites a new user |
| `onRemoveUser` | User removes a user from workspace |
| `onCancel` | User cancels edits |

## Expected User Flows

When fully implemented, users should be able to complete these flows:

### Flow 1: View and Edit User Role

1. User navigates to Workspaces
2. User sees list of all workspace members in the sidebar
3. User clicks on a user (e.g., "Sarah Chen")
4. User sees the user's profile in the detail panel with current role (Editor)
5. User clicks the role dropdown and selects "Admin"
6. User clicks "Save" button
7. **Outcome:** User's role is updated to Admin, detail panel shows new role

### Flow 2: Invite a New User

1. User clicks "Invite User" button
2. User enters email address (e.g., "newuser@example.com")
3. User selects initial role (e.g., "Viewer")
4. User clicks "Send Invitation"
5. **Outcome:** New user appears in sidebar with "invited" status badge

### Flow 3: Remove a User

1. User selects a user from the sidebar
2. User clicks "Remove User" button in detail panel
3. User confirms removal in confirmation modal
4. **Outcome:** User is removed from the sidebar list

### Flow 4: Search for Users

1. User types in the search box at top of sidebar
2. **Outcome:** User list filters to show only matching names or emails

## Empty States

The components include empty state designs. Make sure to handle:

- **No user selected:** Show helpful message in detail panel when no user is selected
- **Empty workspace:** Show CTA to invite first user when workspace has no members
- **No search results:** Show message when search returns no matches

## Role Definitions

| Role | Permissions |
|------|-------------|
| Admin | Full access to all workspace features, including user management |
| Editor | Can create and modify agents and prompt fragments, but cannot manage users |
| Viewer | Read-only access to workspace content |

## Testing

See `product-plan/sections/workspaces/tests.md` for UI behavior test specs covering:
- User flow success and failure paths
- Role changes
- User invitation and removal
- Search and filtering
- Empty state rendering

## Files to Reference

- `product-plan/sections/workspaces/README.md` — Feature overview and design intent
- `product-plan/sections/workspaces/tests.md` — UI behavior test specs
- `product-plan/sections/workspaces/types.ts` — TypeScript interfaces
- `product-plan/sections/workspaces/sample-data.json` — Test data with workspace users

## Done When

- [ ] Components render with real user data
- [ ] User list displays with avatars, names, emails, and status badges
- [ ] Clicking a user loads their detail panel
- [ ] Role changes save correctly
- [ ] User invitation works
- [ ] User removal works with confirmation
- [ ] Search filters the user list
- [ ] Empty states display appropriately
- [ ] Responsive on mobile

```


## product-plan/sections/workspaces/tests.md

```
# Test Specs: Workspaces

These test specs are **framework-agnostic**. Adapt them to your testing setup (Jest, Vitest, Playwright, Cypress, React Testing Library, etc.).

## Overview

The Workspaces section provides user and permission management with a two-panel layout. Administrators can view all workspace users, see their status and role, and modify permissions with role-based access control.

---

## User Flow Tests

### Flow 1: View and Edit User Role

**Scenario:** User views a workspace member and changes their role

#### Success Path

**Setup:**
- Workspaces is loaded with workspace users
- User "Sarah Chen" exists with role "editor"
- No user is currently selected

**Steps:**
1. User navigates to Workspaces
2. User sees list of all workspace members in the sidebar
3. User clicks on "Sarah Chen" in the list
4. User detail panel shows on the right with:
   - Avatar and name "Sarah Chen"
   - Email "sarah.chen@geant.org"
   - Status badge "Active" (green)
   - Current role "Editor"
5. User clicks the role dropdown/selector
6. User selects "Admin" from the options (Admin, Editor, Viewer)
7. User clicks "Save" button
8. **Outcome:** User's role is updated to Admin, detail panel shows new role

**Expected Results:**
- [ ] Clicking user highlights them as selected (violet background)
- [ ] Detail panel shows all user info (avatar, name, email, status, join date)
- [ ] Role selector shows current value highlighted
- [ ] Clicking "Save" triggers the update callback
- [ ] After save, "Role updated successfully" toast appears
- [ ] Sidebar list may reflect new role (if displayed)
- [ ] Detail panel shows "Admin" as current role
- [ ] Save button is disabled after save (no unsaved changes)

#### Failure Path: Save Error

**Steps:**
1. User selects a user
2. User changes role selection
3. User clicks "Save"
4. Backend returns error (e.g., permission denied, network failure)

**Expected Results:**
- [ ] Error message appears: "Failed to update role. Please try again."
- [ ] Role selection remains as user set it (not reverted)
- [ ] Save button remains enabled for retry

### Flow 2: Invite a New User

**Scenario:** User sends an invitation to a new workspace member

#### Success Path

**Setup:**
- Workspaces is loaded
- "newuser@example.com" is not yet in the workspace

**Steps:**
1. User clicks "Invite User" button (top right or in sidebar header)
2. Invite modal appears with email input and role selector
3. User enters email: "newuser@example.com"
4. User selects role: "Viewer"
5. User clicks "Send Invitation"
6. **Outcome:** New user appears in sidebar with "invited" status badge

**Expected Results:**
- [ ] "Invite User" button is visible and clickable
- [ ] Modal shows "Email" input (required)
- [ ] Modal shows role selector with options
- [ ] Email validation prevents invalid formats
- [ ] After clicking send, loading state shows briefly
- [ ] New user appears in sidebar at top or bottom of list
- [ ] New user shows "Invited" status badge (yellow/amber)
- [ ] New user shows avatar with initials
- [ ] Success message: "Invitation sent to newuser@example.com"

#### Failure Path: Email Already Exists

**Steps:**
1. User clicks "Invite User"
2. User enters email of existing user
3. User selects role and clicks "Send Invitation"

**Expected Results:**
- [ ] Error message: "This user is already a member of the workspace"
- [ ] Modal remains open for correction
- [ ] No new user is added to list

#### Failure Path: Invalid Email

**Steps:**
1. User clicks "Invite User"
2. User enters invalid email: "not-an-email"
3. User clicks "Send Invitation"

**Expected Results:**
- [ ] Validation error: "Please enter a valid email address"
- [ ] Send button is disabled or shows error
- [ ] Modal remains open

### Flow 3: Remove a User

**Scenario:** User removes a member from the workspace

#### Success Path

**Setup:**
- User "James Okonkwo" exists in workspace with role "viewer"

**Steps:**
1. User clicks on "James Okonkwo" in the sidebar
2. Detail panel shows user info
3. User clicks "Remove User" button
4. Confirmation modal appears: "Remove James Okonkwo from the workspace?"
5. User clicks "Remove"
6. **Outcome:** User is removed from the sidebar list

**Expected Results:**
- [ ] "Remove User" button is visible in detail panel
- [ ] Confirmation modal shows user's name and warning
- [ ] Modal has "Cancel" and "Remove" buttons
- [ ] After confirmation, user disappears from sidebar
- [ ] Detail panel shows empty state (no user selected)
- [ ] Success message: "User removed from workspace"

#### Failure Path: Cannot Remove Last Admin

**Steps:**
1. User attempts to remove the last admin user
2. User clicks "Remove User" and confirms

**Expected Results:**
- [ ] Error message: "Cannot remove the last admin. Assign admin role to another user first."
- [ ] User remains in the workspace
- [ ] Modal closes

### Flow 4: Search for Users

**Scenario:** User filters the workspace list by search query

#### Success Path

**Setup:**
- Workspace has 10+ users

**Steps:**
1. User types "Sarah" in the search box at top of sidebar
2. **Outcome:** User list filters to show only matching names/emails

**Expected Results:**
- [ ] Search box is visible at top of sidebar
- [ ] Typing updates the list in real-time
- [ ] Matches are found in both names and emails
- [ ] "Sarah Chen" appears in filtered results
- [ ] Non-matching users are hidden
- [ ] Clear button appears when search has text

---

## Empty State Tests

### No User Selected Empty State

**Scenario:** No user is currently selected in the list

**Setup:**
- Workspaces is loaded
- No user has been clicked

**Expected Results:**
- [ ] Detail panel shows "No user selected" message
- [ ] Helpful text: "Select a user from the list to view and edit their profile"
- [ ] Illustration or icon is visible
- [ ] "Invite User" CTA is available

### Empty Workspace Empty State

**Scenario:** The workspace has no members yet

**Setup:**
- Workspace users list is empty

**Expected Results:**
- [ ] Sidebar shows "No users in workspace" message
- [ ] Helpful text: "Invite users to collaborate on agents and prompts"
- [ ] Primary CTA: "Invite User" opens invite modal

### No Search Results Empty State

**Scenario:** Search query returns no matches

**Setup:**
- Workspace has users
- User types search that matches no one

**Expected Results:**
- [ ] Sidebar shows "No users found" message
- [ ] Helpful text: "Try a different search term"
- [ ] Clear search button is available

---

## Component Interaction Tests

### Workspace List (Sidebar)

**Renders correctly:**
- [ ] Shows user avatar (image or initials)
- [ ] Shows user name
- [ ] Shows user email (if space allows)
- [ ] Shows status badge (Active, Invited, Pending)
- [ ] Selected user has violet background
- [ ] Status badges have appropriate colors (green, yellow, gray)

**User interactions:**
- [ ] Clicking user selects them and loads detail panel
- [ ] Typing in search filters the list
- [ ] Clear search button resets the filter
- [ ] Keyboard navigation with arrow keys

### User Detail Panel

**Renders correctly:**
- [ ] Shows user avatar (larger version)
- [ ] Shows full name and email
- [ ] Shows status badge with label
- [ ] Shows join date (if active)
- [ ] Shows current role with description
- [ ] Shows role selector for editing

**User interactions:**
- [ ] Changing role selection enables Save button
- [ ] Clicking Save triggers update callback
- [ ] Clicking Cancel reverts unsaved changes
- [ ] Clicking Remove User shows confirmation modal

### Role Selector

**Renders correctly:**
- [ ] Shows all three roles: Admin, Editor, Viewer
- [ ] Shows description for each role
- [ ] Current role is highlighted/selected

**User interactions:**
- [ ] Clicking role updates selection
- [ ] Role descriptions help users understand permissions

---

## Edge Cases

- [ ] Handles very long user names (truncation)
- [ ] Handles very long email addresses
- [ ] Handles many users (50+) with scrolling
- [ ] Handles users with same name
- [ ] Handles rapid role changes (debouncing)
- [ ] Preserves search state when selecting users
- [ ] Handles removing currently selected user
- [ ] Handles inviting user who already has pending invite

---

## Accessibility Checks

- [ ] All interactive elements are keyboard accessible
- [ ] Status badges have proper ARIA labels
- [ ] Role selector has proper labeling
- [ ] Focus management when opening/closing modals
- [ ] Error messages are announced to screen readers

```


## product-plan/sections/workspaces/README.md

```
# Workspaces

## Overview

A user and permission management interface for administrators to manage workspace members. Provides role-based access control (Admin, Editor, Viewer) with a sidebar navigation listing all users and a main detail panel for viewing and editing individual user profiles and permissions.

## User Flows

- View all users in the workspace via the sidebar list
- Click a user in the sidebar to view their profile, status, and role in the main panel
- Edit a user's role (Admin, Editor, or Viewer) from the detail panel
- Add a new user by entering their email and assigning an initial role
- Remove a user from the workspace
- Filter or search for users by name or email

## Design Decisions

- Two-panel layout allows quick scanning and detailed viewing
- Visual status badges (active, invited, pending) provide immediate context
- Role selector uses radio buttons or dropdown for clarity
- Confirmation dialog prevents accidental user removal
- Search box at top of sidebar for quick filtering

## Data Shapes

**Entities:**
- `WorkspaceUser` — User with profile, role, status, timestamps
- `WorkspaceUserRole` — Role type: admin, editor, viewer
- `WorkspaceUserStatus` — Status type: active, invited, pending
- `RoleDefinition` — Display info for roles (label, description)

**From global entities:** Workspace, User

## Visual Reference

See `screenshot.png` for the target UI design.

## Components Provided

- `Workspaces` — Main component with user list sidebar and detail panel
- `WorkspaceList` — Sidebar listing all workspace users with search
- `UserDetailPanel` — Detail panel showing selected user's profile and role editor

## Callback Props

| Callback | Triggered When |
|----------|---------------|
| `onSelectUser` | User clicks a user in the sidebar |
| `onSearchChange` | User types in search input |
| `onUpdateRole` | User changes a user's role and saves |
| `onInviteUser` | User submits new user invitation |
| `onRemoveUser` | User confirms user removal |
| `onCancel` | User cancels pending edits |

```


## product-plan/sections/workspaces/types.ts

```
/**
 * User roles within a workspace with escalating permissions
 */
export type WorkspaceUserRole = 'admin' | 'editor' | 'viewer'

/**
 * Current status of a user in the workspace
 */
export type WorkspaceUserStatus = 'active' | 'invited' | 'pending'

/**
 * A user who is a member of the workspace
 */
export interface WorkspaceUser {
  /** Unique identifier for the user */
  id: string
  /** Full display name */
  name: string
  /** Email address for login and notifications */
  email: string
  /** URL to user's profile avatar image */
  avatarUrl?: string
  /** Assigned role determining permissions */
  role: WorkspaceUserRole
  /** Current status in the workspace */
  status: WorkspaceUserStatus
  /** ISO timestamp when user joined (null if not yet joined) */
  joinedAt: string | null
  /** ISO timestamp of last activity (null if never active) */
  lastActive: string | null
}

/**
 * Role definition for display and selection
 */
export interface RoleDefinition {
  /** Value to store as the user's role */
  value: WorkspaceUserRole
  /** Human-readable label for UI display */
  label: string
  /** Description of what this role can do */
  description: string
}

/**
 * Props for the Workspaces section
 */
export interface WorkspacesProps {
  /** All users in the current workspace */
  users: WorkspaceUser[]
  /** Available role definitions */
  roles: RoleDefinition[]
  /** Currently selected user ID for detail view */
  selectedUserId?: string | null
  /** Current search/filter query */
  searchQuery?: string

  /** Callback when a user is selected from the sidebar */
  onSelectUser?: (userId: string) => void
  /** Callback when search query changes */
  onSearchChange?: (query: string) => void
  /** Callback when a user's role is changed */
  onUpdateRole?: (userId: string, role: WorkspaceUserRole) => void
  /** Callback when inviting a new user */
  onInviteUser?: (email: string, role: WorkspaceUserRole) => void
  /** Callback when removing a user from workspace */
  onRemoveUser?: (userId: string) => void
  /** Callback when canceling edits */
  onCancel?: () => void
}

```


## product-plan/sections/workspaces/sample-data.json

```
{
  "_meta": {
    "models": {
      "WorkspaceUser": "A user within the workspace with profile information, role, and current status. Represents people who have access to collaborate on agents and prompt libraries."
    },
    "relationships": [
      "WorkspaceUsers belong to a single Workspace (this section manages users within one workspace context)",
      "Roles determine permissions: Admin can manage users, Editor can modify content, Viewer has read-only access"
    ]
  },
  "workspaceUsers": [
    {
      "id": "usr_01",
      "name": "Sarah Chen",
      "email": "sarah.chen@geant.org",
      "avatarUrl": "https://i.pravatar.cc/150?u=sarah.chen",
      "role": "admin",
      "status": "active",
      "joinedAt": "2024-01-15T09:30:00Z",
      "lastActive": "2025-02-19T14:22:00Z"
    },
    {
      "id": "usr_02",
      "name": "Marcus Weber",
      "email": "m.weber@research.ac.uk",
      "avatarUrl": "https://i.pravatar.cc/150?u=marcus.weber",
      "role": "editor",
      "status": "active",
      "joinedAt": "2024-03-22T14:15:00Z",
      "lastActive": "2025-02-18T16:45:00Z"
    },
    {
      "id": "usr_03",
      "name": "Elena Rodriguez",
      "email": "elena.rodriguez@telefonica.es",
      "avatarUrl": "https://i.pravatar.cc/150?u=elena.rodriguez",
      "role": "editor",
      "status": "active",
      "joinedAt": "2024-05-10T08:00:00Z",
      "lastActive": "2025-02-19T11:30:00Z"
    },
    {
      "id": "usr_04",
      "name": "James Okonkwo",
      "email": "j.okonkwo@university.edu",
      "avatarUrl": "https://i.pravatar.cc/150?u=james.okonkwo",
      "role": "viewer",
      "status": "active",
      "joinedAt": "2024-06-18T10:45:00Z",
      "lastActive": "2025-02-15T09:20:00Z"
    },
    {
      "id": "usr_05",
      "name": "Aisha Patel",
      "email": "aisha.p@cern.ch",
      "avatarUrl": "https://i.pravatar.cc/150?u=aisha.patel",
      "role": "editor",
      "status": "active",
      "joinedAt": "2024-07-01T13:20:00Z",
      "lastActive": "2025-02-19T08:15:00Z"
    },
    {
      "id": "usr_06",
      "name": "Thomas Müller",
      "email": "t.mueller@dfn.de",
      "avatarUrl": "https://i.pravatar.cc/150?u=thomas.mueller",
      "role": "viewer",
      "status": "invited",
      "joinedAt": null,
      "lastActive": null
    },
    {
      "id": "usr_07",
      "name": "Linda Johansson",
      "email": "linda.j@sunet.se",
      "avatarUrl": "https://i.pravatar.cc/150?u=linda.johansson",
      "role": "viewer",
      "status": "active",
      "joinedAt": "2024-08-14T11:00:00Z",
      "lastActive": "2025-02-17T15:50:00Z"
    },
    {
      "id": "usr_08",
      "name": "Kwame Osei",
      "email": "kosei@ghrenet.org",
      "avatarUrl": "https://i.pravatar.cc/150?u=kwame.osei",
      "role": "admin",
      "status": "active",
      "joinedAt": "2024-02-28T16:30:00Z",
      "lastActive": "2025-02-19T12:00:00Z"
    },
    {
      "id": "usr_09",
      "name": "Isabelle Dubois",
      "email": "i.dubois@renater.fr",
      "avatarUrl": "https://i.pravatar.cc/150?u=isabelle.dubois",
      "role": "editor",
      "status": "pending",
      "joinedAt": null,
      "lastActive": null
    },
    {
      "id": "usr_10",
      "name": "Pedro Silva",
      "email": "pedro.silva@fccn.pt",
      "avatarUrl": "https://i.pravatar.cc/150?u=pedro.silva",
      "role": "viewer",
      "status": "active",
      "joinedAt": "2024-09-05T09:15:00Z",
      "lastActive": "2025-02-14T10:30:00Z"
    }
  ],
  "roles": [
    {
      "value": "admin",
      "label": "Admin",
      "description": "Full access to all workspace features, including user management"
    },
    {
      "value": "editor",
      "label": "Editor",
      "description": "Can create and modify agents and prompt fragments, but cannot manage users"
    },
    {
      "value": "viewer",
      "label": "Viewer",
      "description": "Read-only access to workspace content"
    }
  ]
}

```


## product-plan/instructions/one-shot-instructions.md

```
# DomainSmith — Complete Implementation Instructions

---

## About This Handoff

**What you're receiving:**
- Finished UI designs (React components with full styling)
- Product requirements and user flow specifications
- Design system tokens (colors, typography)
- Sample data showing the shape of data components expect
- Test specs focused on user-facing behavior

**Your job:**
- Integrate these components into your application
- Wire up callback props to your routing and business logic
- Replace sample data with real data from your backend
- Implement loading, error, and empty states

The components are props-based — they accept data and fire callbacks. How you architect the backend, data layer, and business logic is up to you.

---

## Testing

Each section includes a `tests.md` file with UI behavior test specs. These are **framework-agnostic** — adapt them to your testing setup.

**For each section:**
1. Read `product-plan/sections/[section-id]/tests.md`
2. Write tests for key user flows (success and failure paths)
3. Implement the feature to make tests pass
4. Refactor while keeping tests green

---

# Product Overview

DomainSmith is a multi-user, schema-driven platform that enables domain experts to collaboratively author, visually configure, and deploy highly specialized AI agents without writing code.

The platform provides a modular, file-based approach where experts author isolated prompt fragments (tone, constraints, knowledge) that are automatically assembled into optimized system prompts. Users configure specialized agents through dynamic, type-safe forms generated from directory structures. The system supports isolated workspaces for individual experts and shared environments for cross-functional collaboration, with version-controlled prompt fragments.

## Planned Sections

1. **Shell** — Set up design tokens and application shell with sidebar navigation
2. **Prompt Library** — Implement the filesystem-based workspace for prompt authoring with split-pane file tree and editor interface
3. **Agent Builder** — Build the form-centric control panel for domain selection and agent configuration with live prompt preview
4. **Agent Runtime** — Create the split-pane explorer for browsing, inspecting, and testing deployed agent instances
5. **Workspaces** — Implement the user and permission management interface with role-based access control

---

# Milestone 1: Shell

## Goal

Set up the design tokens and application shell — the persistent chrome that wraps all sections.

## What to Implement

### 1. Design Tokens

Configure your styling system with these tokens:

- See `product-plan/design-system/tokens.css` for CSS custom properties
- See `product-plan/design-system/tailwind-colors.md` for Tailwind configuration
- See `product-plan/design-system/fonts.md` for Google Fonts setup

### 2. Application Shell

Copy the shell components from `product-plan/shell/components/` to your project:

- `AppShell.tsx` — Main layout wrapper
- `MainNav.tsx` — Navigation component
- `UserMenu.tsx` — User menu with avatar

**Wire Up Navigation:**

Connect navigation to your routing:

| Label | Route |
|-------|-------|
| Dashboard | `/` |
| Prompt Library | `/prompt-library` |
| Agent Builder | `/agent-builder` |
| Agent Runtime | `/agent-runtime` |
| Workspaces | `/workspaces` |

**User Menu:**

The user menu expects:
- User name
- Avatar URL (optional)
- Logout callback

## Files to Reference

- `product-plan/design-system/` — Design tokens
- `product-plan/shell/README.md` — Shell design intent
- `product-plan/shell/components/` — Shell React components

## Done When

- [ ] Design tokens are configured
- [ ] Shell renders with navigation
- [ ] Navigation links to correct routes
- [ ] User menu shows user info
- [ ] Responsive on mobile (hamburger menu works)

---

# Milestone 2: Prompt Library

## Goal

Implement the Prompt Library feature — the core workspace where experts author, organize, and manage prompt fragments as a filesystem-based taxonomy of .md files.

## Overview

The Prompt Library provides a split-pane interface with a hierarchical file tree on the left and a WYSIWYG editor on the right. Domain experts create and modify prompt fragments as markdown files organized in folders, with support for frontmatter metadata. This is the foundational content management system for all domain knowledge that will be used to build specialized agents.

**Key Functionality:**
- Browse the hierarchical file tree to explore prompt fragments by domain or category
- View any file by clicking it in the tree to load its content in the editor pane
- Create new files with the "New" button, providing filename and parent folder location
- Edit file content in the WYSIWYG editor with markdown support
- Create folders for organizing related fragments
- Rename or move files and folders through context menus
- Delete files or folders from the library
- Expand and collapse folders in the tree view

## Components Provided

Copy the section components from `product-plan/sections/prompt-library/components/`:

- `PromptLibrary.tsx` — Main split-pane component with file tree and editor

## Props Reference

The components expect these data shapes (see `types.ts` for full definitions):

**Data props:**

- `fileSystem: Directory` — The complete file system tree structure
- `selectedFile: PromptFragment | null` — Currently selected file (if any)
- `expandedFolders: string[]` — Array of folder paths that should be expanded
- `unsavedChanges: boolean` — Whether the current editor has unsaved changes
- `isLoading?: boolean` — Whether a file operation is in progress
- `error?: string | null` — Error message to display

**Callback props:**

| Callback | Triggered When |
|----------|---------------|
| `onSelectFile` | User clicks a file in the tree |
| `onToggleFolder` | User clicks to expand/collapse a folder |
| `onEditContent` | User types in the editor |
| `onSave` | User clicks save or presses Ctrl+S |
| `onCreateFile` | User submits the new file form |
| `onCreateFolder` | User submits the new folder form |
| `onRename` | User renames a node |
| `onMove` | User moves a node to a new parent |
| `onDelete` | User deletes a node |

## Expected User Flows

When fully implemented, users should be able to complete these flows:

### Flow 1: Browse and View a Fragment

1. User navigates to Prompt Library
2. User sees the hierarchical file tree on the left with folders expanded
3. User clicks on a file (e.g., "dns-concepts.md")
4. **Outcome:** File content loads in the editor pane on the right

### Flow 2: Create a New Prompt Fragment

1. User clicks the "New" button in the toolbar
2. User selects "File" from the dropdown
3. User enters filename (e.g., "firewall-rules.md")
4. User selects parent folder from dropdown
5. User clicks "Create"
6. **Outcome:** New file appears in tree, editor opens with blank content, focus is in editor

### Flow 3: Edit and Save a Fragment

1. User opens a file from the tree
2. User makes changes in the WYSIWYG editor
3. User sees unsaved changes indicator (dot or asterisk)
4. User clicks "Save" button or presses Ctrl+S
5. **Outcome:** Changes are saved, unsaved indicator disappears

## Empty States

The components include empty state designs. Make sure to handle:

- **No file selected:** Show helpful message in editor pane when no file is selected
- **Empty library:** Show CTA to create first fragment when library is empty
- **Empty folder:** Handle folders with no children (expandable but shows empty state)

## Testing

See `product-plan/sections/prompt-library/tests.md` for UI behavior test specs.

## Files to Reference

- `product-plan/sections/prompt-library/README.md` — Feature overview
- `product-plan/sections/prompt-library/tests.md` — UI behavior test specs
- `product-plan/sections/prompt-library/types.ts` — TypeScript interfaces
- `product-plan/sections/prompt-library/sample-data.json` — Test data

---

# Milestone 3: Agent Builder

## Goal

Implement the Agent Builder feature — the form-centric control panel where users configure specialized agents by selecting domains and filling out auto-generated forms.

## Overview

The Agent Builder provides a split-view interface with a domain catalog sidebar on the left and a dynamic configuration form on the right. Users select one or more domains (expertise areas), and the system generates a form based on the combined schema. A live preview panel shows the assembled system prompt as users fill out the form. Users can save agent configurations for later use.

**Key Functionality:**
- Browse available domains in the sidebar catalog with descriptions, tags, and category groupings
- Select multiple domains to combine expertise areas
- Fill out dynamically-generated form fields based on selected domain schemas
- View live preview of the generated system prompt with estimated token count
- Save agent configurations with name and description
- Load and edit previously saved agent configurations
- Delete saved agent configurations
- Form validation prevents saving incomplete configurations

## Components Provided

Copy the section components from `product-plan/sections/agent-builder/components/`:

- `AgentBuilder.tsx` — Main component with domain catalog and configuration form
- `DomainCatalog.tsx` — Sidebar listing available domains
- `ConfigurationForm.tsx` — Dynamic form generated from domain schemas
- `PromptPreview.tsx` — Live preview of assembled system prompt
- `SavedAgentsList.tsx` — List of previously saved configurations
- `AgentHeader.tsx` — Header with new/save/load actions

## Props Reference

The components expect these data shapes (see `types.ts` for full definitions):

**Data props:**

- `domains: Domain[]` — Available domains to select from
- `savedAgentConfigs: AgentConfig[]` — Previously saved agent configurations
- `selectedDomainIds?: string[]` — Currently selected domain IDs
- `formValues?: FormValues` — Current form field values
- `loadedAgentId?: string | null` — Currently loaded agent for editing
- `promptPreview?: PromptPreview` — Live-generated preview
- `isLoading?: boolean` — Loading state
- `validationErrors?: Record<string, string>` — Validation errors by field ID

**Callback props:**

| Callback | Triggered When |
|----------|---------------|
| `onDomainsChange` | User selects/deselects domains |
| `onFieldValueChange` | User changes a form field value |
| `onGeneratePreview` | User requests preview update |
| `onSaveAgent` | User saves the agent configuration |
| `onLoadAgent` | User loads an existing agent |
| `onDeleteAgent` | User deletes a saved agent |
| `onNewAgent` | User clicks to create new agent |

## Expected User Flows

### Flow 1: Create a New Agent

1. User opens Agent Builder
2. User browses domains in the catalog sidebar
3. User clicks on one or more domains (they highlight as selected)
4. Configuration form appears on the right with fields from selected domains
5. User fills in form fields (required fields marked)
6. User sees live prompt preview update as they type
7. User clicks "Save Agent" button
8. User enters agent name and description in modal
9. **Outcome:** Agent configuration is saved and appears in saved agents list

### Flow 2: Edit an Existing Agent

1. User opens Agent Builder
2. User clicks on a saved agent in the list
3. Form populates with previously saved values
4. User modifies domain selections or form values
5. User clicks "Save" to update
6. **Outcome:** Updated agent configuration is saved

## Empty States

- **No domains selected:** Show helpful message inviting user to select domains from catalog
- **No saved agents:** Show empty state in saved agents list when no configurations exist
- **Form validation:** Show inline errors when required fields are empty on save attempt

## Testing

See `product-plan/sections/agent-builder/tests.md` for UI behavior test specs.

## Files to Reference

- `product-plan/sections/agent-builder/README.md` — Feature overview
- `product-plan/sections/agent-builder/tests.md` — UI behavior test specs
- `product-plan/sections/agent-builder/types.ts` — TypeScript interfaces
- `product-plan/sections/agent-builder/sample-data.json` — Test data

---

# Milestone 4: Agent Runtime

## Goal

Implement the Agent Runtime feature — a split-pane explorer for browsing, inspecting, and testing deployed agent instances.

## Overview

The Agent Runtime provides a split-pane interface with an agent list on the left and a detail pane on the right. Users can view agents that were generated from the Agent Builder, inspect their assembled system prompts, and run test conversations to validate agent behavior before production use. This is the testing and validation environment for all deployed agents.

**Key Functionality:**
- Browse all available agents in the left-pane list with name, domain/source, and timestamps
- Select an agent to view its details and conversation history
- Expand the collapsible panel to view the full generated system prompt
- Run test conversations by typing messages and receiving agent responses in real-time
- Switch between agents by clicking different items in the list
- Clear conversation history to start a new test session

## Components Provided

Copy the section components from `product-plan/sections/agent-runtime/components/`:

- `AgentRuntime.tsx` — Main split-pane component with agent list and detail view

## Props Reference

The components expect these data shapes (see `types.ts` for full definitions):

**Data props:**

- `agents: Agent[]` — List of all available agents
- `selectedAgentId: string | null` — Currently selected agent (null if none)
- `conversation: Conversation | null` — Active conversation for selected agent
- `isPromptPanelExpanded: boolean` — Whether system prompt panel is expanded
- `isLoading: boolean` — Whether a new message is being sent

**Callback props:**

| Callback | Triggered When |
|----------|---------------|
| `onSelectAgent` | User clicks an agent in the list |
| `onSendMessage` | User sends a new message |
| `onTogglePromptPanel` | User toggles system prompt panel visibility |
| `onClearConversation` | User clears the conversation |
| `onRestartAgent` | User restarts the agent |

## Expected User Flows

### Flow 1: Test an Agent Conversation

1. User navigates to Agent Runtime
2. User sees list of agents on the left with their names and sources
3. User clicks on an agent (e.g., "GDPR Compliance Advisor")
4. User sees the conversation interface on the right
5. User types a message in the input field at the bottom
6. User presses Enter or clicks Send
7. **Outcome:** Message appears in conversation stream, agent response appears below it after a short delay

### Flow 2: View Agent's System Prompt

1. User selects an agent from the list
2. User clicks "View System Prompt" button or header
3. Panel expands showing the full assembled system prompt
4. **Outcome:** User can read the complete prompt that defines the agent's behavior

## Empty States

- **No agent selected:** Show helpful message in detail pane when no agent is selected
- **No conversation yet:** Show empty state in conversation area when starting fresh
- **Empty agent list:** Show message when no agents have been deployed yet

## Testing

See `product-plan/sections/agent-runtime/tests.md` for UI behavior test specs.

## Files to Reference

- `product-plan/sections/agent-runtime/README.md` — Feature overview
- `product-plan/sections/agent-runtime/tests.md` — UI behavior test specs
- `product-plan/sections/agent-runtime/types.ts` — TypeScript interfaces
- `product-plan/sections/agent-runtime/sample-data.json` — Test data

---

# Milestone 5: Workspaces

## Goal

Implement the Workspaces feature — a user and permission management interface for administrators to manage workspace members with role-based access control.

## Overview

The Workspaces section provides a two-panel layout with a user list sidebar on the left and a detail panel on the right. Administrators can view all workspace users, see their status and role, and modify permissions. The interface supports three roles (Admin, Editor, Viewer) and three statuses (active, invited, pending). This is where collaboration and access control are managed for the platform.

**Key Functionality:**
- View all users in the workspace via the sidebar list with avatars and status indicators
- Click a user to view their profile, status, and role in the main detail panel
- Edit a user's role (Admin, Editor, or Viewer) from the detail panel
- Add a new user by entering their email and assigning an initial role
- Remove a user from the workspace with confirmation
- Filter or search for users by name or email
- See visual status badges for user state (active, invited, pending)

## Components Provided

Copy the section components from `product-plan/sections/workspaces/components/`:

- `Workspaces.tsx` — Main component with user list sidebar and detail panel
- `WorkspaceList.tsx` — Sidebar listing all workspace users
- `UserDetailPanel.tsx` — Detail panel showing selected user's profile and role editor

## Props Reference

The components expect these data shapes (see `types.ts` for full definitions):

**Data props:**

- `users: WorkspaceUser[]` — All users in the current workspace
- `roles: RoleDefinition[]` — Available role definitions (Admin, Editor, Viewer)
- `selectedUserId?: string | null` — Currently selected user for detail view
- `searchQuery?: string` — Current search/filter query

**Callback props:**

| Callback | Triggered When |
|----------|---------------|
| `onSelectUser` | User clicks a user in the sidebar |
| `onSearchChange` | User types in search input |
| `onUpdateRole` | User changes a user's role |
| `onInviteUser` | User invites a new user |
| `onRemoveUser` | User removes a user from workspace |
| `onCancel` | User cancels edits |

## Expected User Flows

### Flow 1: View and Edit User Role

1. User navigates to Workspaces
2. User sees list of all workspace members in the sidebar
3. User clicks on a user (e.g., "Sarah Chen")
4. User sees the user's profile in the detail panel with current role (Editor)
5. User clicks the role dropdown and selects "Admin"
6. User clicks "Save" button
7. **Outcome:** User's role is updated to Admin, detail panel shows new role

### Flow 2: Invite a New User

1. User clicks "Invite User" button
2. User enters email address (e.g., "newuser@example.com")
3. User selects initial role (e.g., "Viewer")
4. User clicks "Send Invitation"
5. **Outcome:** New user appears in sidebar with "invited" status badge

## Role Definitions

| Role | Permissions |
|------|-------------|
| Admin | Full access to all workspace features, including user management |
| Editor | Can create and modify agents and prompt fragments, but cannot manage users |
| Viewer | Read-only access to workspace content |

## Empty States

- **No user selected:** Show helpful message in detail panel when no user is selected
- **Empty workspace:** Show CTA to invite first user when workspace has no members
- **No search results:** Show message when search returns no matches

## Testing

See `product-plan/sections/workspaces/tests.md` for UI behavior test specs.

## Files to Reference

- `product-plan/sections/workspaces/README.md` — Feature overview
- `product-plan/sections/workspaces/tests.md` — UI behavior test specs
- `product-plan/sections/workspaces/types.ts` — TypeScript interfaces
- `product-plan/sections/workspaces/sample-data.json` — Test data

```


## product-plan/data-shapes/overview.ts

```
// =============================================================================
// UI Data Shapes — Combined Reference
//
// These types define the data that UI components expect to receive as props.
// They are a frontend contract, not a database schema. How you model, store,
// and fetch this data is an implementation decision.
// =============================================================================

// -----------------------------------------------------------------------------
// From: sections/prompt-library
// -----------------------------------------------------------------------------

/**
 * Type of node in the file system
 */
export type NodeType = 'directory' | 'file';

/**
 * Metadata configuration stored in a directory's config.json file
 */
export interface DirectoryConfig {
  /** Human-readable label for the directory */
  label?: string;
  /** Description of the directory's purpose */
  description?: string;
  /** Icon identifier for UI rendering */
  icon?: string;
  /** Color for visual distinction in UI */
  color?: string;
  /** Additional custom metadata properties */
  [key: string]: unknown;
}

/**
 * Frontmatter metadata from a prompt fragment's markdown file
 */
export interface PromptFrontmatter {
  /** Human-readable title */
  title?: string;
  /** Category for organization */
  category?: string;
  /** Tags for filtering and discovery */
  tags?: string[];
  /** Author identifier */
  author?: string;
  /** ISO date string of creation */
  created?: string;
  /** ISO date string of last modification */
  modified?: string;
  /** Severity or priority level */
  severity?: 'low' | 'medium' | 'high';
  /** Additional custom properties */
  [key: string]: unknown;
}

/**
 * A prompt fragment file in the library
 */
export interface PromptFragment {
  /** Unique identifier for the fragment */
  id: string;
  /** Filename including extension */
  name: string;
  /** Node type discriminator */
  type: 'file';
  /** Full path from root */
  path: string;
  /** Optional frontmatter metadata */
  frontmatter?: PromptFrontmatter;
  /** Markdown content of the prompt */
  content: string;
}

/**
 * A directory that can contain other nodes
 */
export interface Directory {
  /** Unique identifier for the directory */
  id: string;
  /** Directory name */
  name: string;
  /** Node type discriminator */
  type: 'directory';
  /** Full path from root */
  path: string;
  /** Optional directory metadata from config.json */
  config?: DirectoryConfig;
  /** Child nodes (directories and/or files) */
  children?: FileSystemNode[];
}

/**
 * Union type for any node in the file system tree
 */
export type FileSystemNode = Directory | PromptFragment;

// -----------------------------------------------------------------------------
// From: sections/agent-builder
// -----------------------------------------------------------------------------

/**
 * A form field type within a domain's schema
 */
export type SchemaFieldType = 'text' | 'textarea' | 'select' | 'multiselect' | 'toggle';

/**
 * An available domain/expertise area that can be selected when building an agent
 */
export interface Domain {
  /** Unique identifier for the domain */
  id: string;
  /** Human-readable name */
  name: string;
  /** Description of what the domain covers */
  description: string;
  /** Category grouping (e.g., Security, Infrastructure) */
  category: string;
  /** Tags for searchability */
  tags: string[];
  /** Icon identifier for UI display */
  icon: string;
  /** Schema defining form fields for this domain */
  schema: DomainSchema;
  /** Template string for generating the system prompt */
  template: string;
}

/**
 * Schema that defines the form fields for a domain
 */
export interface DomainSchema {
  /** Array of field definitions */
  fields: SchemaField[];
}

/**
 * A single form field definition within a domain's schema
 */
export interface SchemaField {
  /** Unique identifier for the field */
  id: string;
  /** Type of form control */
  type: SchemaFieldType;
  /** Human-readable label */
  label: string;
  /** Placeholder text (for text inputs) */
  placeholder?: string;
  /** Whether the field is required */
  required: boolean;
  /** Default value */
  default: string | string[] | boolean;
  /** Options for select/multiselect fields */
  options?: string[];
}

/**
 * Field values collected from the form - keyed by field ID
 */
export type FormFieldValue = string | string[] | boolean;

/**
 * Map of field IDs to their values
 */
export interface FormValues {
  [fieldId: string]: FormFieldValue;
}

/**
 * A saved agent configuration
 */
export interface AgentConfig {
  /** Unique identifier */
  id: string;
  /** Human-readable name */
  name: string;
  /** Description of the agent's purpose */
  description: string;
  /** IDs of selected domains */
  selectedDomains: string[];
  /** Form field values for all selected domains */
  formValues: FormValues;
  /** When the config was created */
  createdAt: string;
  /** When the config was last updated */
  updatedAt: string;
}

// -----------------------------------------------------------------------------
// From: sections/agent-runtime
// -----------------------------------------------------------------------------

/**
 * Status of an agent instance
 */
export type AgentStatus = "ready" | "starting" | "stopping" | "error";

/**
 * Role of a message sender
 */
export type MessageRole = "user" | "assistant";

/**
 * Reference to the schema and configuration that generated an agent
 */
export interface AgentSource {
  /** ID of the schema used to generate this agent */
  schemaId: string;
  /** Human-readable name of the domain schema */
  schemaName: string;
  /** Workspace where the schema resides */
  workspaceName: string;
}

/**
 * A deployed agent instance with an assembled system prompt
 */
export interface Agent {
  /** Unique identifier for this agent instance */
  id: string;
  /** Display name for the agent */
  name: string;
  /** Brief description of the agent's purpose */
  description: string;
  /** Reference to the domain/schema that generated this agent */
  source: AgentSource;
  /** The full assembled system prompt used by this agent */
  systemPrompt: string;
  /** ISO timestamp when this agent was created */
  createdAt: string;
  /** ISO timestamp when this agent was last used for a conversation */
  lastUsedAt: string | null;
  /** Current status of the agent */
  status: AgentStatus;
}

/**
 * A single message in a conversation thread
 */
export interface Message {
  /** Unique identifier for this message */
  id: string;
  /** Whether the message was sent by the user or the assistant */
  role: MessageRole;
  /** The message content */
  content: string;
  /** ISO timestamp when the message was sent */
  timestamp: string;
}

/**
 * A chat session containing messages exchanged between user and agent
 */
export interface Conversation {
  /** Unique identifier for this conversation */
  id: string;
  /** ID of the agent this conversation is with */
  agentId: string;
  /** Name of the agent (for display) */
  agentName: string;
  /** Messages in this conversation, in chronological order */
  messages: Message[];
  /** ISO timestamp when the conversation was created */
  createdAt: string;
  /** ISO timestamp when the conversation was last updated */
  updatedAt: string;
}

// -----------------------------------------------------------------------------
// From: sections/workspaces
// -----------------------------------------------------------------------------

/**
 * User roles within a workspace with escalating permissions
 */
export type WorkspaceUserRole = 'admin' | 'editor' | 'viewer';

/**
 * Current status of a user in the workspace
 */
export type WorkspaceUserStatus = 'active' | 'invited' | 'pending';

/**
 * A user who is a member of the workspace
 */
export interface WorkspaceUser {
  /** Unique identifier for the user */
  id: string;
  /** Full display name */
  name: string;
  /** Email address for login and notifications */
  email: string;
  /** URL to user's profile avatar image */
  avatarUrl?: string;
  /** Assigned role determining permissions */
  role: WorkspaceUserRole;
  /** Current status in the workspace */
  status: WorkspaceUserStatus;
  /** ISO timestamp when user joined (null if not yet joined) */
  joinedAt: string | null;
  /** ISO timestamp of last activity (null if never active) */
  lastActive: string | null;
}

```


## product-plan/data-shapes/README.md

```
# UI Data Shapes

These types define the shape of data that the UI components expect to receive as props. They represent the **frontend contract** — what the components need to render correctly.

How you model, store, and fetch this data on the backend is an implementation decision. You may combine, split, or extend these types to fit your architecture.

## Entities

- **Directory** — A folder that can contain other directories and/or prompt fragments, with optional metadata configuration (used in: Prompt Library)
- **PromptFragment** — A markdown file containing prompt content with optional frontmatter metadata (used in: Prompt Library)
- **Domain** — An available domain/expertise area that can be selected when building an agent (used in: Agent Builder)
- **SchemaField** — A single form field definition within a domain's schema (used in: Agent Builder)
- **AgentConfig** — A saved agent configuration containing selected domains and form values (used in: Agent Builder, Agent Runtime)
- **Agent** — A deployed agent instance with an assembled system prompt, ready for conversation (used in: Agent Runtime)
- **Message** — A single message in a conversation thread (used in: Agent Runtime)
- **Conversation** — A chat session containing messages exchanged between user and agent (used in: Agent Runtime)
- **WorkspaceUser** — A user within the workspace with profile information, role, and status (used in: Workspaces)

## Per-Section Types

Each section includes its own `types.ts` with the full interface definitions:

- `sections/prompt-library/types.ts`
- `sections/agent-builder/types.ts`
- `sections/agent-runtime/types.ts`
- `sections/workspaces/types.ts`

## Combined Reference

See `overview.ts` for all entity types aggregated in one file.

```
